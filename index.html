<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Adam Miller, Maxim Svistunov, Marie Doleželová, et al.">
<title>RPM Packaging Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>RPM Packaging Guide</h1>
<div class="details">
<span id="author" class="author">Adam Miller, Maxim Svistunov, Marie Doleželová, et al.</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#pdf-version">PDF Version</a></li>
<li><a href="#document-conventions">Document Conventions</a></li>
<li><a href="#contributing-to-this-guide">Contributing to this guide</a></li>
</ul>
</li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#Why-Package-Software-with-RPM">Why Package Software with RPM?</a></li>
<li><a href="#hello-world">Your First RPM Package</a></li>
<li><a href="#preparing-software-for-packaging">Preparing Software for Packaging</a>
<ul class="sectlevel2">
<li><a href="#what-is-source-code">What is Source Code?</a></li>
<li><a href="#how-programs-are-made">How Programs Are Made</a>
<ul class="sectlevel3">
<li><a href="#natively-compiled-code">Natively Compiled Code</a></li>
<li><a href="#interpreted-code">Interpreted Code</a></li>
</ul>
</li>
<li><a href="#building-software-from-source">Building Software from Source</a>
<ul class="sectlevel3">
<li><a href="#natively-compiled-code-building-software-from-source">Natively Compiled Code</a></li>
<li><a href="#interpreted-code-building-software-from-source">Interpreted Code</a></li>
</ul>
</li>
<li><a href="#patching-software">Patching Software</a></li>
<li><a href="#installing-arbitrary-artifacts">Installing Arbitrary Artifacts</a>
<ul class="sectlevel3">
<li><a href="#install-command">Using the install command</a></li>
<li><a href="#make-install">Using the make install command</a></li>
</ul>
</li>
<li><a href="#preparing-source-code-for-packaging">Preparing Source Code for Packaging</a></li>
<li><a href="#putting-source-code-into-tarball">Putting Source Code into Tarball</a>
<ul class="sectlevel3">
<li><a href="#bello">bello</a></li>
<li><a href="#pello">pello</a></li>
<li><a href="#cello">cello</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#packaging-software">Packaging Software</a>
<ul class="sectlevel2">
<li><a href="#rpm-packages">RPM Packages</a>
<ul class="sectlevel3">
<li><a href="#what-is-an-rpm">What is an RPM?</a></li>
<li><a href="#rpm-packaging-tools">RPM Packaging Tools</a></li>
<li><a href="#rpm-packaging-workspace">RPM Packaging Workspace</a></li>
<li><a href="#what-is-a-spec-file">What is a SPEC File?</a></li>
<li><a href="#buildroots">BuildRoots</a></li>
<li><a href="#rpm-macros">RPM Macros</a></li>
<li><a href="#working-with-spec-files">Working with SPEC files</a></li>
</ul>
</li>
<li><a href="#building-rpms">Building RPMS</a>
<ul class="sectlevel3">
<li><a href="#source-rpms">Source RPMs</a></li>
<li><a href="#binary-rpms">Binary RPMS</a></li>
</ul>
</li>
<li><a href="#checking-rpms-for-sanity">Checking RPMs For Sanity</a>
<ul class="sectlevel3">
<li><a href="#checking-bello-spec-file">Checking the bello SPEC File</a></li>
<li><a href="#checking-bello-binary-rpm">Checking the bello Binary RPM</a></li>
<li><a href="#checking-pello-spec-file">Checking the pello SPEC File</a></li>
<li><a href="#checking-pello-binary-rpm">Checking the pello Binary RPM</a></li>
<li><a href="#checking-cello-spec-file">Checking the cello SPEC File</a></li>
<li><a href="#checking-cello-binary-rpm">Checking the cello Binary RPM</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#advanced-topics">Advanced Topics</a>
<ul class="sectlevel2">
<li><a href="#Signing-Packages">Signing Packages</a>
<ul class="sectlevel3">
<li><a href="#Adding-a-Signature-to-a-Package">Adding a Signature to a Package</a></li>
<li><a href="#Replacing-a-Package-Signature">Replacing a Package Signature</a></li>
<li><a href="#Build-time-Signing">Build-time Signing</a></li>
</ul>
</li>
<li><a href="#mock">Mock</a></li>
<li><a href="#version-control-systems">Version Control Systems</a>
<ul class="sectlevel3">
<li><a href="#tito">tito</a></li>
<li><a href="#dist-git">dist-git</a></li>
</ul>
</li>
<li><a href="#more-on-macros">More on Macros</a>
<ul class="sectlevel3">
<li><a href="#defining-your-own">Defining Your Own Macros</a></li>
<li><a href="#setup">%setup</a></li>
<li><a href="#files">%files</a></li>
<li><a href="#built-in-macros">Built-In Macros</a></li>
<li><a href="#rpm-distribution-macros">RPM Distribution Macros</a></li>
</ul>
</li>
<li><a href="#custom-macros">Custom Macros</a></li>
<li><a href="#epoch-scriptlets-and-triggers">Epoch, Scriptlets, and Triggers</a>
<ul class="sectlevel3">
<li><a href="#epoch">Epoch</a></li>
<li><a href="#triggers-and-scriptlets">Scriptlets and Triggers</a></li>
</ul>
</li>
<li><a href="#rpm-conditionals">RPM Conditionals</a>
<ul class="sectlevel3">
<li><a href="#_rpm_conditionals_syntax">RPM Conditionals Syntax</a></li>
<li><a href="#_rpm_conditionals_examples">RPM Conditionals Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_new_features_of_rpm_in_rhel_7">Appendix A: New features of RPM in RHEL 7</a></li>
<li><a href="#_references">Appendix B: References</a></li>
<li><a href="#_acknowledgements">Appendix C: Acknowledgements</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The RPM Packaging Guide documents:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">How to prepare source code for packaging into an RPM.</dt>
<dd>
<p>This is for people with
no background in software development. See
<a href="#preparing-software-for-packaging">Preparing Software for Packaging</a>.</p>
</dd>
<dt class="hdlist1">How to package source code into an RPM.</dt>
<dd>
<p>This is for software developers who
need to package software into RPMs. See <a href="#packaging-software">Packaging Software</a>.</p>
</dd>
<dt class="hdlist1">Advanced packaging scenarios.</dt>
<dd>
<p>This is a reference material for RPM packagers
dealing with advanced RPM Packaging scenarios. See <a href="#advanced-topics">Advanced Topics</a>.</p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="pdf-version">PDF Version</h3>
<div class="paragraph">
<p>You can also download a
<a href="https://rpm-packaging-guide.github.io/rpm-packaging-guide.pdf">PDF version of
this document</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="document-conventions">Document Conventions</h3>
<div class="paragraph">
<p>The document uses the following conventions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Command output and contents of text files, including source code, are placed
in blocks:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ tree ~/rpmbuild/
/home/user/rpmbuild/
|-- BUILD
|-- RPMS

[command output trimmed]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">Name:           bello
Version:
Release:        1%{?dist}
Summary:

[file contents trimmed]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment">#!/usr/bin/env python</span>

print(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</li>
<li>
<p>Topics of interest or vocabulary terms are referred to either as URLs to their
respective documentation or website, in <strong>bold</strong>, or in <em>italics</em>.
The first occurrences of some terms link to their respective documentation.</p>
</li>
<li>
<p>Names of utilities, commands, and things normally found in code are written in
<code>monospace</code> font.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="contributing-to-this-guide">Contributing to this guide</h3>
<div class="paragraph">
<p>You can contribute to this guide by submitting an issue or a pull request on
<a href="https://github.com/redhat-developer/rpm-packaging-guide">the GitHub repository</a>.</p>
</div>
<div class="paragraph">
<p>Both forms of contribution are greatly appreciated and welcome.</p>
</div>
<div class="paragraph">
<p>Feel free to file an issue ticket with feedback, submit a pull request
<a href="https://github.com/redhat-developer/rpm-packaging-guide">on GitHub</a>, or both!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites">Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To follow this tutorial, you need the packages mentioned below.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Some of these packages are installed by default on
<a href="https://getfedora.org/">Fedora</a>, <a href="https://www.centos.org/">CentOS</a> and
<a href="https://www.redhat.com/en/technologies/linux-platforms">RHEL</a>. They are listed
explicitly to show which tools are used in this guide.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On Fedora, CentOS 8, and RHEL 8:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ dnf install gcc rpm-build rpm-devel rpmlint make python bash coreutils diffutils patch rpmdevtools</code></pre>
</div>
</div>
<div class="paragraph">
<p>On CentOS 7 and RHEL 7:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ yum install gcc rpm-build rpm-devel rpmlint make python bash coreutils diffutils patch rpmdevtools</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Why-Package-Software-with-RPM">Why Package Software with RPM?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The RPM Package Manager (RPM) is a package management system that runs on Red
Hat Enterprise Linux, CentOS, and Fedora. RPM makes it easier for you to
distribute, manage, and update software that you create for Red Hat Enterprise
Linux, CentOS, and Fedora. Many software vendors distribute their software via a
conventional archive file (such as a tarball). However, there are several
advantages in packaging software into RPM packages. These advantages are
outlined below.</p>
</div>
<div class="paragraph">
<p>With RPM, you can:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Install, reinstall, remove, upgrade and verify packages</dt>
<dd>
<p>Users can use standard package management tools (for example Yum or PackageKit)
to install, reinstall, remove, upgrade and verify your RPM packages.</p>
</dd>
<dt class="hdlist1">Use a database of installed packages to query and verify packages</dt>
<dd>
<p>Because RPM maintains a database of installed packages and their files, users
can easily query and verify packages on their system.</p>
</dd>
<dt class="hdlist1">Use metadata to describe packages, their installation instructions, and so on</dt>
<dd>
<p>Each RPM package includes metadata that describes the package&#8217;s components,
version, release, size, project URL, installation instructions, and so on.</p>
</dd>
<dt class="hdlist1">Package pristine software sources into source and binary packages</dt>
<dd>
<p>RPM allows you to take pristine software sources and package them into source
and binary packages for your users. In source packages, you have the pristine
sources along with any patches that were used, plus complete build instructions.
This design eases the maintenance of the packages as new versions of your
software are released.</p>
</dd>
<dt class="hdlist1">Add packages to Yum repositories</dt>
<dd>
<p>You can add your package to a Yum repository that enables clients to easily find
and deploy your software.</p>
</dd>
<dt class="hdlist1">Digitally sign your packages</dt>
<dd>
<p>Using a GPG signing key, you can digitally sign your package so that users are
able to verify the authenticity of the package.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hello-world">Your First RPM Package</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Creating an RPM package can be complicated. Here is a complete, working RPM Spec
file with several things skipped and simplified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:       hello-world
Version:    1
Release:    1
Summary:    Most simple RPM package
License:    FIXME

%description
This is my first RPM package, which does nothing.

%prep
# we have no source, so nothing here

%build
cat &gt; hello-world.sh &lt;&lt;EOF
#!/usr/bin/bash
echo Hello world
EOF

%install
mkdir -p %{buildroot}/usr/bin/
install -m 755 hello-world.sh %{buildroot}/usr/bin/hello-world.sh

%files
/usr/bin/hello-world.sh

%changelog
# let's skip this for now</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save this file as <code>hello-world.spec</code>.</p>
</div>
<div class="paragraph">
<p>Now use these commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmdev-setuptree
$ rpmbuild -ba hello-world.spec</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command <code>rpmdev-setuptree</code> creates several working directories. As those
directories are stored permanently in $HOME, this command does not need to be
used again.</p>
</div>
<div class="paragraph">
<p>The command <code>rpmbuild</code> creates the actual rpm package. The output of this
command can be similar to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">... [SNIP]
Wrote: /home/mirek/rpmbuild/SRPMS/hello-world-1-1.src.rpm
Wrote: /home/mirek/rpmbuild/RPMS/x86_64/hello-world-1-1.x86_64.rpm
Executing(%clean): /bin/sh -e /var/tmp/rpm-tmp.wgaJzv
+ umask 022
+ cd /home/mirek/rpmbuild/BUILD
+ /usr/bin/rm -rf /home/mirek/rpmbuild/BUILDROOT/hello-world-1-1.x86_64
+ exit 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The file <code>/home/mirek/rpmbuild/RPMS/x86_64/hello-world-1-1.x86_64.rpm</code> is your
first RPM package. It can be installed in the system and tested.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preparing-software-for-packaging">Preparing Software for Packaging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter is about source code and creating software, which are a necessary
background for an RPM Packager.</p>
</div>
<div class="sect2">
<h3 id="what-is-source-code">What is Source Code?</h3>
<div class="paragraph">
<p><strong>Source code</strong> is human-readable instructions to the computer, which describe
how to perform a computation. Source code is expressed using a
<a href="https://en.wikipedia.org/wiki/Programming_language">programming language</a>
.</p>
</div>
<div class="paragraph">
<p>This tutorial features three versions of the <code>Hello World</code> program, each
written in a different programming language. Programs written in these three
different languages are packaged differently, and cover three major use cases of
an RPM packager.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There are thousands of programming languages. This document features only
three of them, but they are enough for a conceptual overview.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>Hello World</code> written in <a href="https://www.gnu.org/software/bash/">bash</a>:</p>
</div>
<div class="paragraph">
<p><code>bello</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">#!/bin/bash

printf &quot;Hello World\n&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Hello World</code> written in <a href="https://www.python.org/">Python</a>:</p>
</div>
<div class="paragraph">
<p><code>pello.py</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment">#!/usr/bin/env python</span>

print(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Hello World</code> written in
<a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>
:</p>
</div>
<div class="paragraph">
<p><code>cello.c</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><span class="preprocessor">#include</span> <span class="include">&lt;stdio.h&gt;</span>

<span class="predefined-type">int</span> main(<span class="directive">void</span>) {
    printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">return</span> <span class="integer">0</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The purpose of every one of the three programs is to output <code>Hello World</code> on
the command line.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Knowing how to program is not necessary for a software packager, but is
helpful.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="how-programs-are-made">How Programs Are Made</h3>
<div class="paragraph">
<p>There are many methods by which human-readable source code becomes machine code
- instructions the computer follows to actually execute the program. However,
all methods can be reduced to these three:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The program is natively compiled.</p>
</li>
<li>
<p>The program is interpreted by raw interpreting.</p>
</li>
<li>
<p>The program is interpreted by byte compiling.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="natively-compiled-code">Natively Compiled Code</h4>
<div class="paragraph">
<p><strong>Natively compiled</strong> software is software written in a programming language
that compiles to machine code, with a resulting binary executable file. Such
software can be run stand-alone.</p>
</div>
<div class="paragraph">
<p>RPM packages built this way are
<a href="https://en.wikipedia.org/wiki/Microarchitecture">architecture</a>
-specific. This means that if you compile such software on a computer that uses
a 64-bit (x86_64) AMD or Intel processor, it
will not execute on a 32-bit (x86) AMD or Intel processor. The resulting package
will have architecture specified in its name.</p>
</div>
</div>
<div class="sect3">
<h4 id="interpreted-code">Interpreted Code</h4>
<div class="paragraph">
<p>Some programming languages, such as <a href="https://www.gnu.org/software/bash/">bash</a> or
<a href="https://www.python.org/">Python</a>, do not compile to machine code. Instead, their
programs' source code is executed step by step, without prior transformations,
by a
<a href="https://en.wikipedia.org/wiki/Interpreter_%28computing%29">Language Interpreter</a>
or a Language Virtual Machine.</p>
</div>
<div class="paragraph">
<p>Software written entirely in interpreted programming languages is not
<a href="https://en.wikipedia.org/wiki/Microarchitecture">architecture</a>
-specific. Hence, the resulting RPM Package will have string <code>noarch</code> in its name.</p>
</div>
<div class="paragraph">
<p>Interpreted languages are either <strong>byte-compiled</strong> or <strong>raw-interpreted</strong>. These two
types differ in program build process and in packaging procedure.</p>
</div>
<div class="sect4">
<h5 id="_raw_interpreted_programs">Raw-interpreted programs</h5>
<div class="paragraph">
<p>Raw-interpreted language programs do not need to be compiled at all, they are
directly executed by the interpreter.</p>
</div>
</div>
<div class="sect4">
<h5 id="_byte_compiled_programs">Byte-compiled programs</h5>
<div class="paragraph">
<p>Byte-compiled languages need to be compiled into byte code, which is then
executed by the language virtual machine.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Some languages give a choice: they can be raw-interpreted or byte-compiled.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="building-software-from-source">Building Software from Source</h3>
<div class="paragraph">
<p>This section explains building software from its source code.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For software written in compiled languages, the source code goes through a
<strong>build</strong> process, producing machine code. This process, commonly called
<strong>compiling</strong> or <strong>translating</strong>, varies for different languages. The resulting
built software can be <strong>run</strong> or "<strong>executed</strong>", which makes computer perform
the task specified by the programmer.</p>
</li>
<li>
<p>For software written in raw interpreted languages, the source code is not
built, but executed directly.</p>
</li>
<li>
<p>For software written in byte-compiled interpreted languages, the source code
is compiled into byte code, which is then executed by the language virtual
machine.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="natively-compiled-code-building-software-from-source">Natively Compiled Code</h4>
<div class="paragraph">
<p>In this example, you will build the <code>cello.c</code> program written in the
<a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>
language into an executable.</p>
</div>
<div class="paragraph">
<p><code>cello.c</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><span class="preprocessor">#include</span> <span class="include">&lt;stdio.h&gt;</span>

<span class="predefined-type">int</span> main(<span class="directive">void</span>) {
    printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">return</span> <span class="integer">0</span>;
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="manual-building">Manual Building</h5>
<div class="paragraph">
<p>Invoke the
<a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>
compiler from the GNU
Compiler Collection (<a href="https://gcc.gnu.org/">GCC</a>) to compile the source code into binary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcc -g -o cello cello.c</code></pre>
</div>
</div>
<div class="paragraph">
<p>Execute the resulting output binary <code>cello</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./cello
Hello World</code></pre>
</div>
</div>
<div class="paragraph">
<p>That is all. You have built and ran natively compiled software from source code.</p>
</div>
</div>
<div class="sect4">
<h5 id="_automated_building">Automated Building</h5>
<div class="paragraph">
<p>Instead of building the source code manually, you can automate the building.
This is a common practice used by large-scale software. Automating building is
done by creating a <code>Makefile</code> and then running the
<a href="http://www.gnu.org/software/make/">GNU <code>make</code></a> utility.</p>
</div>
<div class="paragraph">
<p>To set up automated building, create a file named <code>Makefile</code> in the same
directory as <code>cello.c</code>:</p>
</div>
<div class="paragraph">
<p><code>Makefile</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="makefile">cello:
        gcc -g -o cello cello.c

clean:
        rm cello</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now to build the software, simply run <code>make</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make
make: 'cello' is up to date.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since there is already a build present, <code>make clean</code> it and run <code>make</code> again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make clean
rm cello

$ make
gcc -g -o cello cello.c</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, trying to build after another build would do nothing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make
make: 'cello' is up to date.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, execute the program:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./cello
Hello World</code></pre>
</div>
</div>
<div class="paragraph">
<p>You have now compiled a program both manually and using a build tool.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="interpreted-code-building-software-from-source">Interpreted Code</h4>
<div class="paragraph">
<p>The next two examples showcase byte-compiling a program written in
<a href="https://www.python.org/">Python</a> and raw-interpreting a program written in
<a href="https://www.gnu.org/software/bash/">bash</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In the two examples below, the <code>#!</code> line at the top of the file is known as a
<a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a>
and is not part of the programming language source code.</p>
</div>
<div class="paragraph">
<p>The
<a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a>
enables using a text file as an executable: the system
program loader parses the line containing the <strong>shebang</strong> to get a path to the
binary executable, which is then used as the programming language interpreter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="byte-compiled-code">Byte-Compiled Code</h5>
<div class="paragraph">
<p>In this example, you will compile the <code>pello.py</code> program written in Python
into byte code, which is then executed by the Python language virtual machine.
Python source code can also be raw-interpreted, but the byte-compiled version is
faster. Hence, RPM Packagers prefer to package the byte-compiled version for
distribution to end users.</p>
</div>
<div class="paragraph">
<p><code>pello.py</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment">#!/usr/bin/env python</span>

print(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Procedure for byte-compiling programs is different for different languages. It
depends on the language, the language&#8217;s virtual machine, and the tools and
processes used with that language.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<a href="https://www.python.org/">Python</a> is often byte-compiled, but not in the way
described here. The following procedure aims not to conform to the community
standards, but to be simple. For real-world Python guidelines, see
<a href="https://docs.python.org/2/library/distribution.html">Software Packaging and
Distribution</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Byte-compile <code>pello.py</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ python -m compileall pello.py

$ file pello.pyc
pello.pyc: python 2.7 byte-compiled</code></pre>
</div>
</div>
<div class="paragraph">
<p>Execute the byte code in <code>pello.pyc</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ python pello.pyc
Hello World</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="raw-interpreted">Raw Interpreted Code</h5>
<div class="paragraph">
<p>In this example, you will raw-interpret the <code>bello</code> program written in the
<a href="https://www.gnu.org/software/bash/">bash</a> shell built-in language.</p>
</div>
<div class="paragraph">
<p><code>bello</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">#!/bin/bash

printf &quot;Hello World\n&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Programs written in shell scripting languages, like <em>bash</em>, are raw-interpreted.
Hence, you only need to make the file with source code executable and run it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ chmod +x bello
$ ./bello
Hello World</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="patching-software">Patching Software</h3>
<div class="paragraph">
<p>A <strong>patch</strong> is source code that updates other source code. It is formatted as a
<em>diff</em>, because it represents what is different between two versions of text.
A <em>diff</em> is created using the <code>diff</code> utility, which is then applied to the
source code using the <a href="http://savannah.gnu.org/projects/patch/">patch</a> utility.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Software developers often use Version Control Systems such as
<a href="https://git-scm.com/">git</a> to manage their code base. Such tools provide their
own methods of creating diffs or patching software.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following example, we create a patch from the original source code using
<code>diff</code> and then apply it using <code>patch</code>. Patching is used in a later section
when creating an RPM, <a href="#working-with-spec-files">Working with SPEC files</a>.</p>
</div>
<div class="paragraph">
<p>How is patching related to RPM packaging? In packaging, instead of simply
modifying the original source code, we keep it, and use patches on it.</p>
</div>
<div class="paragraph">
<p>To create a patch for <code>cello.c</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Preserve the original source code:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cp cello.c cello.c.orig</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a common way to preserve the original source code file.</p>
</div>
</li>
<li>
<p>Change <code>cello.c</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><span class="preprocessor">#include</span> <span class="include">&lt;stdio.h&gt;</span>

<span class="predefined-type">int</span> main(<span class="directive">void</span>) {
    printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World from my very first patch!</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">return</span> <span class="integer">0</span>;
}</code></pre>
</div>
</div>
</li>
<li>
<p>Generate a patch using the <code>diff</code> utility:</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
We use several common arguments for the <code>diff</code> utility. For more
information on them, see the <code>diff</code> manual page.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="diff"><span class="line comment">$ diff -Naur cello.c.orig cello.c</span>
<span class="line head"><span class="head">--- </span><span class="filename">cello.c.orig        2016-05-26 17:21:30.478523360 -0500</span></span>
<span class="line head"><span class="head">+++ </span><span class="filename">cello.c     2016-05-27 14:53:20.668588245 -0500</span></span>
<span class="line change"><span class="change">@@</span> -1,6 +1,6 <span class="change">@@</span></span>
 #include&lt;stdio.h&gt;

 int main(void){
<span class="line delete"><span class="delete">-</span>    printf(&quot;Hello World!\n&quot;);</span>
<span class="line insert"><span class="insert">+</span>    printf(&quot;Hello World<span class="eyecatcher"> from my very first patch</span>!\n&quot;);</span>
     return 0;
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lines starting with a <code>-</code> are removed from the original source code and
replaced with the lines that start with <code>+</code>.</p>
</div>
</li>
<li>
<p>Save the patch to a file:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ diff -Naur cello.c.orig cello.c &gt; cello-output-first-patch.patch</code></pre>
</div>
</div>
</li>
<li>
<p>Restore the original <code>cello.c</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cp cello.c.orig cello.c</code></pre>
</div>
</div>
<div class="paragraph">
<p>We retain the original <code>cello.c</code>, because when an RPM is built, the original
file is used, not a modified one. For more information, see
<a href="#working-with-spec-files">Working with SPEC files</a>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To patch <code>cello.c</code> using <code>cello-output-first-patch.patch</code>, redirect the
patch file to the <code>patch</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ patch &lt; cello-output-first-patch.patch
patching file cello.c</code></pre>
</div>
</div>
<div class="paragraph">
<p>The contents of <code>cello.c</code> now reflect the patch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cat cello.c
#include&lt;stdio.h&gt;

int main(void){
    printf(&quot;Hello World from my very first patch!\n&quot;);
    return 0;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To build and run the patched <code>cello.c</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make clean
rm cello

$ make
gcc -g -o cello cello.c

$ ./cello
Hello World from my very first patch!</code></pre>
</div>
</div>
<div class="paragraph">
<p>You have created a patch, patched a program, built the patched program, and run
it.</p>
</div>
</div>
<div class="sect2">
<h3 id="installing-arbitrary-artifacts">Installing Arbitrary Artifacts</h3>
<div class="paragraph">
<p>A big advantage of
<a href="https://en.wikipedia.org/wiki/Linux">Linux</a>
and other Unix-like systems is the
<a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Filesystem Hierarchy Standard</a>
(FHS). It specifies in which directory which files should be located. Files installed from
the RPM packages should be placed according to FHS. For example, an executable
file should go into a directory that is in the system
<a href="https://en.wikipedia.org/wiki/PATH_%28variable%29">PATH</a>
variable.</p>
</div>
<div class="paragraph">
<p>In the context of this guide, an <em>Arbitrary Artifact</em> is anything installed
from an RPM to the system. For RPM and for the system it can be a script, a
binary compiled from the package&#8217;s source code, a pre-compiled binary, or any
other file.</p>
</div>
<div class="paragraph">
<p>We will explore two popular ways of placing <em>Arbitrary Artifacts</em> in the
system: using the <code>install</code> command and using the <code>make install</code> command.</p>
</div>
<div class="sect3">
<h4 id="install-command">Using the install command</h4>
<div class="paragraph">
<p>Sometimes using build automation tooling such as
<a href="http://www.gnu.org/software/make/">GNU make</a> is not optimal - for example, if the
packaged program is simple and does not need extra overhead. In these cases,
packagers often use the <code>install</code> command (provided to the system by
<a href="http://www.gnu.org/software/coreutils/coreutils.html">coreutils</a>), which places
the artifact to the specified directory in the filesystem with a specified set
of permissions.</p>
</div>
<div class="paragraph">
<p>The example below is going to use the <code>bello</code> file that we had previously
created as the arbitrary artifact subject to our installation method. Note that
you will either need <a href="http://www.sudo.ws/">sudo</a> permissions or run this command
as root excluding the <code>sudo</code> portion of the command.</p>
</div>
<div class="paragraph">
<p>In this example, <code>install</code> places the <code>bello</code> file into <code>/usr/bin</code> with
permissions common for executable scripts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ sudo install -m 0755 bello /usr/bin/bello</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now <code>bello</code> is in a directory that is listed in the
<a href="https://en.wikipedia.org/wiki/PATH_%28variable%29">$PATH</a>
variable. Therefore,
you can execute <code>bello</code> from any directory without specifying its full path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd ~

$ bello
Hello World</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="make-install">Using the make install command</h4>
<div class="paragraph">
<p>A popular automated way to install built software to the system is to use the
<code>make install</code> command. It requires you to specify how to install the
arbitrary artifacts to the system in the <code>Makefile</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Usually <code>Makefile</code> is written by the developer and not by the packager.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Add the <code>install</code> section to the <code>Makefile</code>:</p>
</div>
<div class="paragraph">
<p><code>Makefile</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="makefile">cello:
        gcc -g -o cello cello.c

clean:
        rm cello

install:
        mkdir -p $(DESTDIR)/usr/bin
        install -m 0755 cello $(DESTDIR)/usr/bin/cello</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://www.gnu.org/software/make/manual/html_node/DESTDIR.html">$(DESTDIR)</a>
variable is a <a href="http://www.gnu.org/software/make/">GNU make</a> built-in and is
commonly used to specify installation to a directory different than the root
directory.</p>
</div>
<div class="paragraph">
<p>Now you can use <code>Makefile</code> not only to build software, but also to install it
to the target system.</p>
</div>
<div class="paragraph">
<p>To build and install the <code>cello.c</code> program:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make
gcc -g -o cello cello.c

$ sudo make install
install -m 0755 cello /usr/bin/cello</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now <code>cello</code> is in a directory that is listed in the
<a href="https://en.wikipedia.org/wiki/PATH_%28variable%29">$PATH</a>
variable. Therefore,
you can execute <code>cello</code> from any directory without specifying its full path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd ~

$ cello
Hello World</code></pre>
</div>
</div>
<div class="paragraph">
<p>You have installed a build artifact into a chosen location on the system.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="preparing-source-code-for-packaging">Preparing Source Code for Packaging</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The code created in this section can be found
<a href="https://github.com/redhat-developer/rpm-packaging-guide/tree/master/example-code">here</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Developers often distribute software as compressed archives of source code,
which are then used to create packages. In this section, you will create such
compressed archives.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Creating source code archives is not normally done by the RPM Packager,
but by the developer. The packager works with a ready source code archive.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Software should be distributed with a
<a href="https://en.wikipedia.org/wiki/Software_license">software license</a>
. For the
examples, we will use the
<a href="https://www.gnu.org/licenses/quick-guide-gplv3.html">GPLv3</a> license. The license
text goes into the <code>LICENSE</code> file for each of the example programs. An RPM
packager needs to deal with license files when packaging.</p>
</div>
<div class="paragraph">
<p>For use with the following examples, create a <code>LICENSE</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cat /tmp/LICENSE
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="putting-source-code-into-tarball">Putting Source Code into Tarball</h3>
<div class="paragraph">
<p>In the examples below, we put each of the three <code>Hello World</code> programs into a
<a href="https://www.gnu.org/software/gzip/">gzip</a>-compressed tarball. Software is often
released this way to be later packaged for distribution.</p>
</div>
<div class="sect3">
<h4 id="bello">bello</h4>
<div class="paragraph">
<p>The <em>bello</em> project implements <code>Hello World</code> in
<a href="https://www.gnu.org/software/bash/">bash</a>. The implementation only contains the
<code>bello</code> shell script, so the resulting <code>tar.gz</code> archive will have only one
file apart from the <code>LICENSE</code> file. Let us assume that this is version <code>0.1</code>
of the program.</p>
</div>
<div class="paragraph">
<p>Prepare the <em>bello</em> project for distribution:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Put the files into a single directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mkdir /tmp/bello-0.1

$ mv ~/bello /tmp/bello-0.1/

$ cp /tmp/LICENSE /tmp/bello-0.1/</code></pre>
</div>
</div>
</li>
<li>
<p>Create the archive for distribution and move it to <code>~/rpmbuild/SOURCES/</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd /tmp/

$ tar -cvzf bello-0.1.tar.gz bello-0.1
bello-0.1/
bello-0.1/LICENSE
bello-0.1/bello

$ mv /tmp/bello-0.1.tar.gz ~/rpmbuild/SOURCES/</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="pello">pello</h4>
<div class="paragraph">
<p>The <em>pello</em> project implements <code>Hello World</code> in
<a href="https://www.python.org/">Python</a>. The implementation only contains the
<code>pello.py</code> program, so the resulting <code>tar.gz</code> archive will have only one
file apart from the <code>LICENSE</code> file. Let us assume that this is version
<code>0.1.1</code> of the program.</p>
</div>
<div class="paragraph">
<p>Prepare the <em>pello</em> project for distribution:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Put the files into a single directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mkdir /tmp/pello-0.1.1

$ mv ~/pello.py /tmp/pello-0.1.1/

$ cp /tmp/LICENSE /tmp/pello-0.1.1/</code></pre>
</div>
</div>
</li>
<li>
<p>Create the archive for distribution and move it to <code>~/rpmbuild/SOURCES/</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd /tmp/

$ tar -cvzf pello-0.1.1.tar.gz pello-0.1.1
pello-0.1.1/
pello-0.1.1/LICENSE
pello-0.1.1/pello.py

$ mv /tmp/pello-0.1.1.tar.gz ~/rpmbuild/SOURCES/</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="cello">cello</h4>
<div class="paragraph">
<p>The <em>cello</em> project implements <code>Hello World</code> in
<a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>
. The implementation only contains the <code>cello.c</code> and
<code>Makefile</code> files, so the resulting <code>tar.gz</code> archive will have only two files
apart from the <code>LICENSE</code> file. Let us assume that this is version <code>1.0</code> of
the program.</p>
</div>
<div class="paragraph">
<p>Note that the <code>patch</code> file is not distributed in the archive with the program.
The RPM Packager applies the patch when the RPM is built. The patch will be
placed in the <code>~/rpmbuild/SOURCES/</code> directory alongside the <code>.tar.gz</code>.</p>
</div>
<div class="paragraph">
<p>Prepare the <em>cello</em> project for distribution:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Put the files into a single directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mkdir /tmp/cello-1.0

$ mv ~/cello.c /tmp/cello-1.0/

$ mv ~/Makefile /tmp/cello-1.0/

$ cp /tmp/LICENSE /tmp/cello-1.0/</code></pre>
</div>
</div>
</li>
<li>
<p>Create the archive for distribution and move it to <code>~/rpmbuild/SOURCES/</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd /tmp/

$ tar -cvzf cello-1.0.tar.gz cello-1.0
cello-1.0/
cello-1.0/Makefile
cello-1.0/cello.c
cello-1.0/LICENSE

$ mv /tmp/cello-1.0.tar.gz ~/rpmbuild/SOURCES/</code></pre>
</div>
</div>
</li>
<li>
<p>Add the patch:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mv ~/cello-output-first-patch.patch ~/rpmbuild/SOURCES/</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now the source code is ready for packaging into an RPM.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="packaging-software">Packaging Software</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This tutorial explains packaging RPMs for the Red Hat family of Linux
distributions, primarily:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://getfedora.org/">Fedora</a></p>
</li>
<li>
<p><a href="https://www.centos.org/">CentOS</a></p>
</li>
<li>
<p><a href="https://www.redhat.com/en/technologies/linux-platforms">Red Hat Enterprise Linux</a> (<a href="https://www.redhat.com/en/technologies/linux-platforms">RHEL</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These distributions use the <a href="http://rpm.org/">RPM</a> Packaging Format.</p>
</div>
<div class="paragraph">
<p>While these distributions are the target environment, this guide is mostly
applicable to all
<a href="https://en.wikipedia.org/wiki/List_of_Linux_distributions#RPM-based">RPM based</a>
distributions. However, the instructions need to be adapted for
distribution-specific features, such as prerequisite installation items,
guidelines, or macros.</p>
</div>
<div class="paragraph">
<p>This tutorial assumes no previous knowledge about packaging software for any
Operating System, Linux or otherwise.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you do not know what a software package or a GNU/Linux distribution is,
consider exploring some articles on the topics of
<a href="https://en.wikipedia.org/wiki/Linux">Linux</a> and
<a href="https://en.wikipedia.org/wiki/Package_manager">Package Managers</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="rpm-packages">RPM Packages</h3>
<div class="paragraph">
<p>This section covers the basics of the RPM packaging format. See
<a href="#advanced-topics">Advanced Topics</a> for more advanced information.</p>
</div>
<div class="sect3">
<h4 id="what-is-an-rpm">What is an RPM?</h4>
<div class="paragraph">
<p>An RPM package is simply a file containing other files and information about
them needed by the system. Specifically, an RPM package consists of the
<a href="https://en.wikipedia.org/wiki/Cpio">cpio</a>
archive, which contains the files, and the RPM header, which contains metadata
about the package. The <code>rpm</code> package manager uses this metadata to determine
dependencies, where to install files, and other information.</p>
</div>
<div class="paragraph">
<p>There are two types of RPM packages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>source RPM (SRPM)</p>
</li>
<li>
<p>binary RPM</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>SRPMs and binary RPMs share the file format and tooling, but have different
contents and serve different purposes. An SRPM contains source code, optionally
patches to it, and a SPEC file, which describes how to build the source code
into a binary RPM. A binary RPM contains the binaries built from the sources and
patches.</p>
</div>
</div>
<div class="sect3">
<h4 id="rpm-packaging-tools">RPM Packaging Tools</h4>
<div class="paragraph">
<p>The <code>rpmdevtools</code> package, installed in <a href="#prerequisites">Prerequisites</a>, provides several
utilities for packaging RPMs. To list these utilities, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -ql rpmdevtools | grep bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on the above utilities, see their manual pages or help
dialogs.</p>
</div>
</div>
<div class="sect3">
<h4 id="rpm-packaging-workspace">RPM Packaging Workspace</h4>
<div class="paragraph">
<p>To set up a directory layout that is the RPM packaging workspace, use the
<code>rpmdev-setuptree</code> utility:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmdev-setuptree

$ tree ~/rpmbuild/
/home/user/rpmbuild/
|-- BUILD
|-- RPMS
|-- SOURCES
|-- SPECS
`-- SRPMS

5 directories, 0 files</code></pre>
</div>
</div>
<div class="paragraph">
<p>The created directories serve these purposes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Purpose</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BUILD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When packages are built, various <code>%buildroot</code> directories are created here. This is useful for investigating a failed build if the logs output do not provide enough information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RPMS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary RPMs are created here, in subdirectories for different architectures, for example in subdirectories <code>x86_64</code> and <code>noarch</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOURCES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Here, the packager puts compressed source code archives and patches. The <code>rpmbuild</code> command looks for them here.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPECS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The packager puts SPEC files here.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SRPMS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When <code>rpmbuild</code> is used to build an SRPM instead of a binary RPM, the resulting SRPM is created here.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="what-is-a-spec-file">What is a SPEC File?</h4>
<div class="paragraph">
<p>A SPEC file can be thought of as the "recipe" that the <code>rpmbuild</code> utility uses
to actually build an RPM. It tells the build system what to do by defining
instructions in a series of sections. The sections are defined in the
<em>Preamble</em> and the <em>Body</em>. The <em>Preamble</em> contains a series of metadata
items that are used in the <em>Body</em>. The <em>Body</em> contains the main part of the
instructions.</p>
</div>
<div class="sect4">
<h5 id="preamble-items">Preamble Items</h5>
<div class="paragraph">
<p>This table lists the items used in the Preamble section of the RPM SPEC file:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPEC Directive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The base name of the package, which should match the SPEC file name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The upstream version number of the software.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Release</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of times this version of the software was released. Normally, set the initial value to 1%{?dist}, and increment it with each new release of the package. Reset to 1 when a new <code>Version</code> of the software is built.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Summary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A brief, one-line summary of the package.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>License</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The license of the software being packaged.
For packages distributed in community distributions such as <a href="https://getfedora.org/">Fedora</a> this must be an open source license abiding by the specific distribution’s licensing guidelines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>URL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The full URL for more information about the program. Most often this is the upstream project website for the software being packaged.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Source0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path or URL to the compressed archive of the upstream source code (unpatched, patches are handled elsewhere). This should point to an accessible and reliable storage of the archive, for example, the upstream page and not the packager&#8217;s local storage. If needed, more SourceX directives can be added, incrementing the number each time, for example: Source1, Source2, Source3, and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Patch0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the first patch to apply to the source code if necessary. If needed, more PatchX directives can be added, incrementing the number each time, for example: Patch1, Patch2, Patch3, and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BuildArch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the package is not architecture dependent, for example, if written entirely in an interpreted programming language, set this to <code>BuildArch: noarch</code>. If not set, the package automatically inherits the Architecture of the machine on which it is built, for example <code>x86_64</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BuildRequires</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma- or whitespace-separated list of packages required for building the program written in a compiled language. There can be multiple entries of <code>BuildRequires</code>, each on its own line in the SPEC file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Requires</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma- or whitespace-separated list of packages required by the software to run once installed. There can be multiple entries of <code>Requires</code>, each on its own line in the SPEC file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExcludeArch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a piece of software can not operate on a specific processor architecture, you can exclude that architecture here.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>Name</code>, <code>Version</code>, and <code>Release</code> directives comprise the file name of
the RPM package. RPM Package Maintainers and Systems Administrators often call
these three directives <strong>N-V-R</strong> or <strong>NVR</strong>, because RPM package filenames have
the <code>NAME-VERSION-RELEASE</code> format.</p>
</div>
<div class="paragraph">
<p>You can get an example of an <code>NAME-VERSION-RELEASE</code> by querying using <code>rpm</code>
for a specific package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -q python
python-2.7.5-34.el7.x86_64</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, <code>python</code> is the Package Name, <code>2.7.5</code> is the Version, and <code>34.el7</code>
is the Release. The final marker is <code>x86_64</code>, which signals the architecture.
Unlike the <strong>NVR</strong>, the architecture marker is not under direct control of the
RPM packager, but is defined by the <code>rpmbuild</code> build environment. The
exception to this is the architecture-independent <code>noarch</code> package.</p>
</div>
</div>
<div class="sect4">
<h5 id="body-items">Body Items</h5>
<div class="paragraph">
<p>This table lists the items used in the Body section of the RPM SPEC file:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPEC Directive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A full description of the software packaged in the RPM. This description can span multiple lines and can be broken into paragraphs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%prep</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command or series of commands to prepare the software to be built, for example, unpacking the archive in <code>Source0</code>. This directive can contain a shell script.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%build</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command or series of commands for actually building the software into machine code (for compiled languages) or byte code (for some interpreted languages).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%install</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command or series of commands for copying the desired build artifacts from the <code>%builddir</code> (where the build happens) to the <code>%buildroot</code> directory (which contains the directory structure with the files to be packaged). This usually means copying files from <code>~/rpmbuild/BUILD</code> to <code>~/rpmbuild/BUILDROOT</code> and creating the necessary directories in <code>~/rpmbuild/BUILDROOT</code>. This is only run when creating a package, not when the end-user installs the package. See <a href="#working-with-spec-files">Working with SPEC files</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%check</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command or series of commands to test the software. This normally includes things such as unit tests.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%files</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of files that will be installed in the end user&#8217;s system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%changelog</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A record of changes that have happened to the package between different <code>Version</code> or <code>Release</code> builds.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="advanced-items">Advanced items</h5>
<div class="paragraph">
<p>The SPEC file can also contain advanced items. For example, a SPEC file can have
<em>scriptlets</em> and <em>triggers</em>. They take effect at different points during the
installation process on the end user&#8217;s system (not the build process).</p>
</div>
<div class="paragraph">
<p>See the <a href="#triggers-and-scriptlets">Scriptlets and Triggers</a> for advanced topics.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="buildroots">BuildRoots</h4>
<div class="paragraph">
<p>In the context of RPM packaging, "buildroot" is a
<a href="https://en.wikipedia.org/wiki/Chroot">chroot</a>
environment. This means that the build artifacts are placed
here using the same filesystem hierarchy as will be in the end user&#8217;s system,
with "buildroot" acting as the root directory. The placement of build artifacts
should comply with the filesystem hierarchy standard of the end user&#8217;s system.</p>
</div>
<div class="paragraph">
<p>The files in "buildroot" are later put into a
<a href="https://en.wikipedia.org/wiki/Cpio">cpio</a>
archive, which becomes the main part of
the RPM. When RPM is installed on the end user&#8217;s system, these files are
extracted in the root directory, preserving the correct hierarchy.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Starting from Red Hat Enterprise Linux 6 release, the <code>rpmbuild</code> program has its
own defaults. As overriding these defaults leads to several problems, Red Hat
does not recommend to define your own value of this macro. You can use the
<code>%{buildroot}</code> macro with the defaults from the <code>rpmbuild</code> directory.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="rpm-macros">RPM Macros</h4>
<div class="paragraph">
<p>An <a href="http://rpm.org/user_doc/macros.html">rpm macro</a> is a straight text
substitution that can be conditionally assigned based on the optional evaluation
of a statement when certain built-in functionality is used. What this means is
that you can have RPM perform text substitutions for you so that you don’t have
to.</p>
</div>
<div class="paragraph">
<p>This is useful when, for example, referencing the packaged software <em>Version</em>
multiple times in the SPEC file. You define <em>Version</em> only once - in the
<code>%{version}</code> macro. Then use <code>%{version}</code> throughout the SPEC file. Every
occurrence will be automatically substituted by <em>Version</em> you defined
previously.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you see an unfamiliar macro, you can evaluate it with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --eval %{_MACRO}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --eval %{_bindir}
/usr/bin

$ rpm --eval %{_libexecdir}
/usr/libexec</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A common macro is <code>%{?dist}</code>, which signifies the “distribution tag”. It
signals which distribution is used for the build.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># On a RHEL 7.x machine
$ rpm --eval %{?dist}
.el7

# On a Fedora 23 machine
$ rpm --eval %{?dist}
.fc23</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on macros, see <a href="#more-on-macros">More on Macros</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="working-with-spec-files">Working with SPEC files</h4>
<div class="paragraph">
<p>A big part of packaging software into RPMs is editing the SPEC file. In this
section we discuss how to create and modify a spec file.</p>
</div>
<div class="paragraph">
<p>To package new software, you need to create a new SPEC file. Instead of writing
it manually from scratch, use the <code>rpmdev-newspec</code> utility. It creates an
unpopulated SPEC file, and you fill in the necessary directives and fields.</p>
</div>
<div class="paragraph">
<p>For this tutorial, we use the three example implementations of the 'Hello
World!' program created in <a href="#preparing-software-for-packaging">Preparing Software for Packaging</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/redhat-developer/rpm-packaging-guide/raw/master/example-code/bello-0.1.tar.gz">bello-0.1.tar.gz</a></p>
</li>
<li>
<p><a href="https://github.com/redhat-developer/rpm-packaging-guide/raw/master/example-code/pello-0.1.1.tar.gz">pello-0.1.1.tar.gz</a></p>
</li>
<li>
<p><a href="https://github.com/redhat-developer/rpm-packaging-guide/raw/master/example-code/cello-1.0.tar.gz">cello-1.0.tar.gz</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://raw.githubusercontent.com/redhat-developer/rpm-packaging-guide/master/example-code/cello-output-first-patch.patch">cello-output-first-patch.patch</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Place them in <code>~/rpmbuild/SOURCES</code>.</p>
</div>
<div class="paragraph">
<p>Create a SPEC file for each of the three programs:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Some programmer-focused text editors pre-populate a new <code>.spec</code> file
with their own SPEC template. The <code>rpmdev-newspec</code> provides an editor-agnostic
method, which is why it is used in this guide.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd ~/rpmbuild/SPECS

$ rpmdev-newspec bello
bello.spec created; type minimal, rpm version &gt;= 4.11.

$ rpmdev-newspec cello
cello.spec created; type minimal, rpm version &gt;= 4.11.

$ rpmdev-newspec pello
pello.spec created; type minimal, rpm version &gt;= 4.11.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>~/rpmbuild/SPECS/</code> directory now contains three SPEC files named
<code>bello.spec</code>, <code>cello.spec</code>, and <code>pello.spec</code>.</p>
</div>
<div class="paragraph">
<p>Examine the files. The directives in them represent the ones described in the
<a href="#what-is-a-spec-file">What is a SPEC File?</a> section. In the following sections, you will populate
these SPEC files.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>rpmdev-newspec</code> utility does not use guidelines or conventions specific
to any particular Linux distribution. However, this document targets Fedora,
CentOS, and RHEL, so you will notice that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use <code>rm $RPM_BUILD_ROOT</code>when building on <em>CentOS</em> (versions previous to 7.0)
or on <a href="https://getfedora.org/">Fedora</a> (versions previous to 18).</p>
</li>
<li>
<p>We favor the use of <code>%{buildroot}</code> notation over <code>$RPM_BUILD_ROOT</code> when
referencing RPM’s Buildroot for consistency with all other defined or provided
macros throughout the SPEC file.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are three examples below. Each one is fully described, so you can go to
a specific one if it matches your packaging needs. Or, read them all to fully
explore packaging different kinds of software.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 85%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explanation of example</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A program written in a raw interpreted programming language. It demonstrates when the source code does not need to be built, but only needs to be installed. If a pre-compiled binary needs to be packaged, you can also use this method since the binary would also just be a file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A program written in a byte-compiled interpreted programming language. It demonstrates byte-compiling the source code and installating the bytecode - the resulting pre-optimized files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A program written in a natively compiled programming language. It demonstrates a common process of compiling the source code into machine code and installing the resulting executables.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="bello-working-with-spec-files">bello</h5>
<div class="paragraph">
<p>The first SPEC file is for the <code>bello</code> bash shell script from
<a href="#preparing-software-for-packaging">Preparing Software for Packaging</a>.</p>
</div>
<div class="paragraph">
<p>Ensure that you have:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Placed <code>bello</code> source code into <code>~/rpmbuild/SOURCES/</code>. See
<a href="#working-with-spec-files">Working with SPEC files</a>.</p>
</li>
<li>
<p>Created the unpopulated SPEC file <code>~/rpmbuild/SPECS/bello.spec</code>. The file
has these contents:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           bello
Version:
Release:        1%{?dist}
Summary:

License:
URL:
Source0:

BuildRequires:
Requires:

%description

%prep
%setup -q

%build
%configure
make %{?_smp_mflags}

%install
rm -rf $RPM_BUILD_ROOT
%make_install

%files
%doc

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt;
-</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now, modify <code>~/rpmbuild/SPECS/bello.spec</code> for creating <code>bello</code> RPMs:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Populate the <code>Name</code>, <code>Version</code>, <code>Release</code>, and <code>Summary</code> directives:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>Name</code> was already specified as an argument to <code>rpmdev-newspec</code>.</p>
</li>
<li>
<p>Set the <code>Version</code> to match the “upstream” release version of the <code>bello</code>
source code, <code>0.1</code>.</p>
</li>
<li>
<p>The <code>Release</code> is automatically set to <code>1%{?dist}</code>, which is initially
<code>1</code>. Increment the initial value whenever updating the package without a
change in the upstream release <code>Version</code> - such as when including a patch.
Reset <code>Release</code> to <code>1</code> when a new upstream release happens, for example, if
bello version <code>0.2</code> is released. The <em>disttag</em> macro is covered in
<a href="#rpm-macros">RPM Macros</a>.</p>
</li>
<li>
<p>The <code>Summary</code> is a short, one-line explanation of what this software is.</p>
<div class="paragraph">
<p>After your edits, the first section of the SPEC file should
resemble:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           bello
Version:        0.1
Release:        1%{?dist}
Summary:        Hello World example implemented in bash script</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Populate the <code>License</code>, <code>URL</code>, and <code>Source0</code> directives:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>License</code> field is the
<a href="https://en.wikipedia.org/wiki/Software_license">Software License</a>
associated with
the source code from the upstream release.</p>
<div class="paragraph">
<p>Follow this format for the <code>License</code> field:
<a href="https://fedoraproject.org/wiki/Licensing:Main">Fedora License Guidelines</a></p>
</div>
<div class="paragraph">
<p>For example, use <code>GPLv3+</code>.</p>
</div>
</li>
<li>
<p>The <code>URL</code> field provides URL to the upstream software page. For example, use
<code><a href="https://example.com/bello" class="bare">https://example.com/bello</a></code>. However, for consistency, utilize the %{name}
macro and instead use <code><a href="https://example.com/%{name}" class="bare">https://example.com/%{name}</a></code>.</p>
</li>
<li>
<p>The <code>Source0</code> field provides URL to the upstream software source code. It
should link directly to the version of software that is being packaged. In this
example, we can use <code><a href="https://example.com/bello/releases/bello-0.1.tar.gz" class="bare">https://example.com/bello/releases/bello-0.1.tar.gz</a></code>.
Instead, use the %{name} macro. Also, use the %{version} macro to accommodate for
changes in version. The resulting entry is
<code><a href="https://example.com/%{name}/releases/%{name}-%{version}.tar.gz" class="bare">https://example.com/%{name}/releases/%{name}-%{version}.tar.gz</a></code>.</p>
<div class="paragraph">
<p>After your edits, the first section of the SPEC file should resemble:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           bello
Version:        0.1
Release:        1%{?dist}
Summary:        Hello World example implemented in bash script

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Populate the <code>BuildRequires</code> and <code>Requires</code> directives and include the
<code>BuildArch</code> directive:</p>
<div class="ulist">
<ul>
<li>
<p><code>BuildRequires</code> specifies build-time dependencies for the package. There is
no building step for <code>bello</code>, because bash is a raw interpreted programming
language, and the files are simply installed to their location on the system.
Just delete this directive.</p>
</li>
<li>
<p><code>Requires</code> specifies run-time dependencies for the package. The <code>bello</code>
script requires only the <code>bash</code> shell environment to execute, so specify <code>bash</code>
in this directive.</p>
</li>
<li>
<p>Since this is software written in an interpreted programming language with no
natively compiled extensions, add the <code>BuildArch</code> directive with the
<code>noarch</code> value. This tells RPM that this package does not need to be bound to
the processor architecture on which it is built.</p>
<div class="paragraph">
<p>After your edits, the first section of the SPEC file should resemble:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           bello
Version:        0.1
Release:        1%{?dist}
Summary:        Hello World example implemented in bash script

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz

Requires:       bash

BuildArch:      noarch</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Populate the <code>%description</code>, <code>%prep</code>, <code>%build</code>, <code>%install</code>,
<code>%files</code>, and <code>%license</code> directives. These directives can be thought of as
“section headings”, because they are directives that can define multi-line,
multi-instruction, or scripted tasks to occur.</p>
<div class="ulist">
<ul>
<li>
<p>The <code>%description</code> is a longer, fuller description of the software than
<code>Summary</code>, containing one or more paragraphs. In our example we will use only
a short description.</p>
</li>
<li>
<p>The <code>%prep</code> section specifies how to prepare the build environment. This
usually involves expansion of compressed archives of the source code,
application of patches, and, potentially, parsing of information provided in the
source code for use in a later portion of the SPEC. In this section we simply
use the built-in macro <code>%setup -q</code>.</p>
</li>
<li>
<p>The <code>%build</code> section specifies how to actually build the software we are
packaging. However, since a <code>bash</code> does not need to be built, simply remove
what was provided by the template and leave this section blank.</p>
</li>
<li>
<p>The <code>%install</code> section contains instructions for <code>rpmbuild</code> on how to
install the software, once it has been built, into the <code>BUILDROOT</code> directory.
This directory is an empty
<a href="https://en.wikipedia.org/wiki/Chroot">chroot</a>
base
directory, which resembles the end user&#8217;s root directory. Here we should create
any directories that will contain the installed files.</p>
<div class="paragraph">
<p>Since for installing <code>bello</code> we only need to create the destination directory
and install the executable <code>bash</code> script file there, we will use the
<code>install</code> command. RPM macros allow us to do this without hardcoding paths.</p>
</div>
<div class="paragraph">
<p>The <code>%install</code> section should look like the following after your edits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%install

mkdir -p %{buildroot}/%{_bindir}

install -m 0755 %{name} %{buildroot}/%{_bindir}/%{name}</code></pre>
</div>
</div>
</li>
<li>
<p>The <code>%files</code> section specifies the list of files provided by this RPM and
their full path location on the end user&#8217;s system. Therefore, the listing for
the <code>bello</code> file we are installing is <code>/usr/bin/bello</code>, or, with RPM Macros,
<code>%{_bindir}/%{name}</code>.</p>
<div class="paragraph">
<p>Within this section, you can indicate the role of various files using built-in
macros. This is useful for querying the package file manifest metadata using the
<code>rpm</code> command. For example, to indicate that the LICENSE file is a software
license file, we use the %license macro.</p>
</div>
<div class="paragraph">
<p>After your edits, the <code>%files</code> section looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%files
%license LICENSE
%{_bindir}/%{name}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>The last section, <code>%changelog</code>, is a list of datestamped entries for each
Version-Release of the package. They log packaging changes, not software
changes. Examples of packaging changes: adding a patch, changing the build
procedure in <code>%build</code>.</p>
<div class="paragraph">
<p>Follow this format for the first line:</p>
</div>
<div class="paragraph">
<p><code>* Day-of-Week Month Day Year Name Surname &lt;email&gt; - Version-Release</code></p>
</div>
<div class="paragraph">
<p>Follow this format for the actual change entry:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Each change entry can contain multiple items - one for each change</p>
</li>
<li>
<p>Each item starts on a new line.</p>
</li>
<li>
<p>Each item begins with a <code>-</code> character.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>An example datestamped entry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 0.1-1
- First bello package
- Example second item in the changelog for version-release 0.1-1</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have now written an entire SPEC file for <strong>bello</strong>. The full SPEC file for
<strong>bello</strong> now resembles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           bello
Version:        0.1
Release:        1%{?dist}
Summary:        Hello World example implemented in bash script

License:        GPLv3+
URL:            https://www.example.com/%{name}
Source0:        https://www.example.com/%{name}/releases/%{name}-%{version}.tar.gz

Requires:       bash

BuildArch:      noarch

%description
The long-tail description for our Hello World Example implemented in
bash script.

%prep
%setup -q

%build

%install

mkdir -p %{buildroot}/%{_bindir}

install -m 0755 %{name} %{buildroot}/%{_bindir}/%{name}

%files
%license LICENSE
%{_bindir}/%{name}

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 0.1-1
- First bello package
- Example second item in the changelog for version-release 0.1-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next section covers how to build the RPM.</p>
</div>
</div>
<div class="sect4">
<h5 id="pello-working-with-spec-files">pello</h5>
<div class="paragraph">
<p>Our second SPEC file will be for our example written in the <a href="https://www.python.org/">Python</a>
programming language that  you downloaded (or you created a simulated upstream
release in the <a href="#preparing-software-for-packaging">Preparing Software for Packaging</a> section) and placed its
source code into <code>~/rpmbuild/SOURCES/</code> earlier. Let’s go ahead and open the
file <code>~/rpmbuild/SPECS/pello.spec</code> and start filling in some fields.</p>
</div>
<div class="paragraph">
<p>Before we start down this path, we need to address something somewhat unique
about byte-compiled interpreted software. Since we will be byte-compiling this
program, the
<a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a>
is no longer applicable because the resulting file will not
contain the entry. It is common practice to either have a non-byte-compiled
shell script that will call the executable or have a small bit of the
<a href="https://www.python.org/">Python</a> code that isn’t byte-compiled as the “entry
point” into the program’s execution. This might seem silly for our small example
but for large software projects with many thousands of lines of code, the
performance increase of pre-byte-compiled code is sizeable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The creation of a script to call the byte-compiled code or having a
non-byte-compiled entry point into the software is something that upstream
software developers most often address before doing a release of their software
to the world, however this is not always the case and this exercise is meant to
help address what to do in those situations. For more information on how
<a href="https://www.python.org/">Python</a> code is normally released and distributed please
reference the <a href="https://docs.python.org/2/library/distribution.html">Software
Packaging and Distribution</a> documentation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We will make a small shell script to call our byte compiled code to be the entry
point into our software. We will do this as a part of our SPEC file itself in
order to demonstrate how you can script actions inside the SPEC file. We will
cover the specifics of this in the <code>%install</code> section later.</p>
</div>
<div class="paragraph">
<p>Let’s go ahead and open the file <code>~/rpmbuild/SPECS/pello.spec</code> and start
filling in some fields.</p>
</div>
<div class="paragraph">
<p>The following is the output template we were given from <code>rpmdev-newspec</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           pello
Version:
Release:        1%{?dist}
Summary:

License:
URL:
Source0:

BuildRequires:
Requires:

%description

%prep
%setup -q

%build
%configure
make %{?_smp_mflags}

%install
rm -rf $RPM_BUILD_ROOT
%make_install

%files
%doc

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt;
-</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just as with the first example, let’s begin with the first set of directives
that <code>rpmdev-newspec</code> has grouped together at the top of the file: <code>Name</code>,
<code>Version</code>, <code>Release</code>, <code>Summary</code>. The <code>Name</code> is already specified because
we provided that information to the command line for <code>rpmdev-newspec</code>.</p>
</div>
<div class="paragraph">
<p>Let’s set the <code>Version</code> to match what the “upstream” release version of the
<em>pello</em> source code is, which we can observe is <code>0.1.1</code> as set by the
example code we downloaded (or we created in the
<a href="#preparing-software-for-packaging">Preparing Software for Packaging</a> section).</p>
</div>
<div class="paragraph">
<p>The <code>Release</code> is already set to <code>1%{?dist}</code> for us, the numerical value
which is initially <code>1</code> should be incremented every time the package is updated
for any reason, such as including a new patch to fix an issue, but doesn’t have
a new upstream release <code>Version</code>. When a new upstream release happens (for
example, pello version <code>0.1.2</code> were released) then the <code>Release</code> number
should be reset to <code>1</code>. The <em>disttag</em> of <code>%{?dist}</code> should look familiar
from the previous section’s coverage of <a href="#rpm-macros">RPM Macros</a>.</p>
</div>
<div class="paragraph">
<p>The <code>Summary</code> should be a short, one-line explanation of what this software
is.</p>
</div>
<div class="paragraph">
<p>After your edits, the first section of the SPEC file should resemble the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           pello
Version:        0.1.1
Release:        1%{?dist}
Summary:        Hello World example implemented in Python</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let’s move on to the second set of directives that <code>rpmdev-newspec</code> has
grouped together in our SPEC file: <code>License</code>, <code>URL</code>, <code>Source0</code>.</p>
</div>
<div class="paragraph">
<p>The <code>License</code> field is the
<a href="https://en.wikipedia.org/wiki/Software_license">Software License</a> associated with
the source code from the upstream release. The exact format for how to label the
License in your SPEC file will vary depending on which specific RPM based
<a href="https://en.wikipedia.org/wiki/Linux">Linux</a> distribution guidelines you are
following, we will use the notation standards in the
<a href="https://fedoraproject.org/wiki/Licensing:Main">Fedora License Guidelines</a> for
this document and as such this field will contain the text <code>GPLv3+</code></p>
</div>
<div class="paragraph">
<p>The <code>URL</code> field is the upstream software’s website, not the source code
download link but the actual project, product, or company website where someone
would find more information about this particular piece of software. Since we’re
just using an example, we will call this <code><a href="https://example.com/pello" class="bare">https://example.com/pello</a></code>. However,
we will use the RPM macro variable of <code>%{name}</code> in its place for consistency.</p>
</div>
<div class="paragraph">
<p>The <code>Source0</code> field is where the upstream software’s source code should be
able to be downloaded from. This URL should link directly to the specific
version of the source code release that this RPM Package is packaging. Once
again, since this is an example we will use an example value:
<code><a href="https://example.com/pello/releases/pello-0.1.1.tar.gz" class="bare">https://example.com/pello/releases/pello-0.1.1.tar.gz</a></code></p>
</div>
<div class="paragraph">
<p>We should note that this example URL has hard coded values in it that are
possible to change in the future and are potentially even likely to change such
as the release version <code>0.1.1</code>. We can simplify this by only needing to update
one field in the SPEC file and allowing it to be reused. we will use the value
<code><a href="https://example.com/%{name}/releases/%{name}-%{version}.tar.gz" class="bare">https://example.com/%{name}/releases/%{name}-%{version}.tar.gz</a></code> instead of
the hard coded examples string previously listed.</p>
</div>
<div class="paragraph">
<p>After your edits, the top portion of your spec file should look like the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           pello
Version:        0.1.1
Release:        1%{?dist}
Summary:        Hello World example implemented in Python

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next up we have <code>BuildRequires</code> and <code>Requires</code>, each of which define
something that is required by the package. However, <code>BuildRequires</code> is to tell
<code>rpmbuild</code> what is needed by your package at <strong>build</strong> time and <code>Requires</code>
is what is needed by your package at <strong>run</strong> time.</p>
</div>
<div class="paragraph">
<p>In this example we will need the <code>python</code> package in order to perform the
byte-compile build process. We will also need the <code>python</code> package in order to
execute the byte-compiled code at runtime and therefore need to define
<code>python</code> as a requirement using the <code>Requires</code> directive. We will also need
the <code>bash</code> package in order to execute the small entry-point script we will
use here.</p>
</div>
<div class="paragraph">
<p>Something we need to add here since this is software written in an interpreted
programming language with no natively compiled extensions is a <code>BuildArch</code>
entry that is set to <code>noarch</code> in order to tell RPM that this package does not
need to be bound to the processor architecture that it is built using.</p>
</div>
<div class="paragraph">
<p>After your edits, the top portion of your spec file should look like the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           pello
Version:        0.1.1
Release:        1%{?dist}
Summary:        Hello World example implemented in Python

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz

BuildRequires:  python
Requires:       python
Requires:       bash

BuildArch:      noarch</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following directives can be thought of as “section headings” because they
are directives that can define multi-line, multi-instruction, or scripted tasks
to occur. We will walk through them one by one just as we did with the previous
items.</p>
</div>
<div class="paragraph">
<p>The <code>%description</code> should be a longer, more full length description of the
software being packaged than what is found in the <code>Summary</code> directive. For the
sake of our example, this isn’t really going to contain much content but this
section can be a full paragraph or more than one paragraph if desired.</p>
</div>
<div class="paragraph">
<p>The <code>%prep</code> section is where we <em>prepare</em> our build environment or workspace
for building. Most often what happens here is the expansion of compressed
archives of the source code, application of patches, and potentially parsing of
information provided in the source code that is necessary in a later portion of
the SPEC. In this section we will simply use the provided macro <code>%setup -q</code>.</p>
</div>
<div class="paragraph">
<p>The <code>%build</code> section is where we tell the system how to actually build the
software we are packaging. Here we will perform a byte-compilation of our
software. For those who read the <a href="#preparing-software-for-packaging">Preparing Software for Packaging</a>
section, this portion of the example should look familiar.</p>
</div>
<div class="paragraph">
<p>The <code>%build</code> section of our SPEC file should look as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%build

python -m compileall pello.py</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>%install</code> section is where we instruct <code>rpmbuild</code> how to install our
previously built software into the <code>BUILDROOT</code> which is effectively a
<a href="https://en.wikipedia.org/wiki/Chroot">chroot</a>
base directory with nothing in it and we will have to
construct any paths or directory hierarchies that we will need in order to
install our software here in their specific locations. However, our RPM Macros
help us accomplish this task without having to hardcode paths.</p>
</div>
<div class="paragraph">
<p>We had previously discussed that since we will lose the context of a file with the
<a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a>
line in it when we byte compile that we will need to create
a simple wrapper script in order to accomplish that task. There are many options
on how to accomplish this including, but not limited to, making a separate
script and using that as a separate <code>SourceX</code> directive and the option we’re
going to show in this example which is to create the file in-line in the SPEC
file. The reason for showing the example option that we are is simply to
demonstrate that the SPEC file itself is scriptable. What we’re going to do is
create a small“wrapper script” which will execute the
<a href="https://www.python.org/">Python</a> byte-compiled code by using a
<a href="https://en.wikipedia.org/wiki/Here_document">here document</a>
. We will also need to actually install the byte-compiled file into a library
directory on the system such that it can be accessed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You will notice below that we are hard coding the library path. There are
various methods to avoid needing to do this, many of which are addressed in
<a href="#advanced-topics">Advanced Topics</a>, under the <a href="#more-on-macros">More on Macros</a> section, and are specific
to the programming language in which the software that is being packaged was
written in. In this example we hard code the path for simplicity as to not cover
too many topics simultaneously.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>%install</code> section should look like the following after your edits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%install

mkdir -p %{buildroot}/%{_bindir}
mkdir -p %{buildroot}/usr/lib/%{name}

cat &gt; %{buildroot}/%{_bindir}/%{name} &lt;&lt;-EOF
#!/bin/bash
/usr/bin/python /usr/lib/%{name}/%{name}.pyc
EOF

chmod 0755 %{buildroot}/%{_bindir}/%{name}

install -m 0644 %{name}.py* %{buildroot}/usr/lib/%{name}/</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>%files</code> section is where we provide the list of files that this RPM
provides and where it’s intended for them to live on the system that the RPM is
installed upon. Note here that this isn’t relative to the <code>%{buildroot}</code> but
the full path for the files as they are expected to exist on the end system
after installation. Therefore, the listing for the <code>pello</code> file we are
installing will be <code>%{_bindir}/pello</code>. We will also need to provide a <code>%dir</code>
listing to define that this package “owns” the library directory we created as
well as all the files we placed in it.</p>
</div>
<div class="paragraph">
<p>Also, within this section you will sometimes need a built-in macro to provide
context on a file. This can be useful for Systems Administrators and end users
who might want to query the system with <code>rpm</code> about the resulting package. The
built-in macro we will use here is <code>%license</code> which will tell <code>rpmbuild</code>
that this is a software license file in the package file manifest metadata.</p>
</div>
<div class="paragraph">
<p>The <code>%files</code> section should look like the following after your edits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%files
%license LICENSE
%dir /usr/lib/%{name}/
%{_bindir}/%{name}
/usr/lib/%{name}/%{name}.py*</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last section, <code>%changelog</code> is a list of date-stamped entries that
correlate to a specific Version-Release of the package. This is not meant to be
a log of what changed in the software from release to release, but specifically
to packaging changes. For example, if software in a package needed patching or
there was a change needed in the build procedure listed in the <code>%build</code>
section that information would go here. Each change entry can contain multiple
items and each item should start on a new line and begin with a <code>-</code> character.
Below is our example entry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 0.1.1-1
- First pello package
- Example second item in the changelog for version-release 0.1.1-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the format above, the date-stamp will begin with a <code>*</code> character,
followed by the calendar day of the week, the month, the day of the month, the
year, then the contact information for the RPM Packager. From there we have a
<code>-</code> character before the Version-Release, which is an often used convention
but not a requirement. Then finally the Version-Release.</p>
</div>
<div class="paragraph">
<p>That’s it! We’ve written an entire SPEC file for <strong>pello</strong>! In the next section
we will cover how to build the RPM!</p>
</div>
<div class="paragraph">
<p>The full SPEC file should now look like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           pello
Version:        0.1.1
Release:        1%{?dist}
Summary:        Hello World example implemented in python

License:        GPLv3+
URL:            https://www.example.com/%{name}
Source0:        https://www.example.com/%{name}/releases/%{name}-%{version}.tar.gz

BuildRequires:  python
Requires:       python
Requires:       bash

BuildArch:      noarch

%description
The long-tail description for our Hello World Example implemented in
Python.

%prep
%setup -q

%build

python -m compileall %{name}.py

%install

mkdir -p %{buildroot}/%{_bindir}
mkdir -p %{buildroot}/usr/lib/%{name}

cat &gt; %{buildroot}/%{_bindir}/%{name} &lt;&lt;-EOF
#!/bin/bash
/usr/bin/python /usr/lib/%{name}/%{name}.pyc
EOF

chmod 0755 %{buildroot}/%{_bindir}/%{name}

install -m 0644 %{name}.py* %{buildroot}/usr/lib/%{name}/

%files
%license LICENSE
%dir /usr/lib/%{name}/
%{_bindir}/%{name}
/usr/lib/%{name}/%{name}.py*

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 0.1.1-1
  - First pello package</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cello-working-with-spec-files">cello</h5>
<div class="paragraph">
<p>Our third SPEC file will be for our example written in the
<a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>
programming
language that we created a simulated upstream release of previously (or you
downloaded) and placed its source code into <code>~/rpmbuild/SOURCES/</code> earlier.</p>
</div>
<div class="paragraph">
<p>Let’s go ahead and open the file <code>~/rpmbuild/SPECS/cello.spec</code> and start
filling in some fields.</p>
</div>
<div class="paragraph">
<p>The following is the output template we were given from <code>rpmdev-newspec</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           cello
Version:
Release:        1%{?dist}
Summary:

License:
URL:
Source0:

BuildRequires:
Requires:

%description

%prep
%setup -q

%build
%configure
make %{?_smp_mflags}

%install
rm -rf $RPM_BUILD_ROOT
%make_install

%files
%doc

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt;
-</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just as with the previous examples, let’s begin with the first set of directives
that <code>rpmdev-newspec</code> has grouped together at the top of the file:
<code>Name</code>, <code>Version</code>, <code>Release</code>, <code>Summary</code>. The <code>Name</code> is already
specified because we provided that information to the command line for
<code>rpmdev-newspec</code>.</p>
</div>
<div class="paragraph">
<p>Let’s set the <code>Version</code> to match what the “upstream” release version of the
<em>cello</em> source code is, which we can observe is <code>1.0</code> as set by the example
code we downloaded (or we created in the <a href="#preparing-software-for-packaging">Preparing Software for Packaging</a>
section).</p>
</div>
<div class="paragraph">
<p>The <code>Release</code> is already set to <code>1%{?dist}</code> for us, the numerical value
which is initially <code>1</code> should be incremented every time the package is updated
for any reason, such as including a new patch to fix an issue, but doesn’t have
a new upstream release <code>Version</code>. When a new upstream release happens (for
example, cello version <code>2.0</code> were released) then the <code>Release</code> number should
be reset to <code>1</code>. The <em>disttag</em> of <code>%{?dist}</code> should look familiar from the
previous section’s coverage of <a href="#rpm-macros">RPM Macros</a>.</p>
</div>
<div class="paragraph">
<p>The <code>Summary</code> should be a short, one-line explanation of what this software
is.</p>
</div>
<div class="paragraph">
<p>After your edits, the first section of the SPEC file should resemble the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           cello
Version:        1.0
Release:        1%{?dist}
Summary:        Hello World example implemented in C</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let’s move on to the second set of directives that <code>rpmdev-newspec</code> has
grouped together in our SPEC file: <code>License</code>, <code>URL</code>, <code>Source0</code>. However,
we will add one to this grouping as it is closely related to the <code>Source0</code> and
that is our <code>Patch0</code> which will list the first patch we need against our
software.</p>
</div>
<div class="paragraph">
<p>The <code>License</code> field is the
<a href="https://en.wikipedia.org/wiki/Software_license">Software License</a>
associated with the source code
from the upstream release. The exact format for how to label the License in your
SPEC file will vary depending on which specific RPM based
<a href="https://en.wikipedia.org/wiki/Linux">Linux</a>
distribution guidelines you are following, we will use the notation standards in
the <a href="https://fedoraproject.org/wiki/Licensing:Main">Fedora License Guidelines</a>
for this document and as such this field will contain the text <code>GPLv3+</code></p>
</div>
<div class="paragraph">
<p>The <code>URL</code> field is the upstream software’s website, not the source code
download link but the actual project, product, or company website where someone
would find more information about this particular piece of software. Since we’re
just using an example, we will call this <code><a href="https://example.com/cello" class="bare">https://example.com/cello</a></code>. However,
we will use the rpm macro variable of <code>%{name}</code> in its place for consistency.</p>
</div>
<div class="paragraph">
<p>The <code>Source0</code> field is where the upstream software’s source code should be
able to be downloaded from. This URL should link directly to the specific
version of the source code release that this RPM Package is packaging. Once
again, since this is an example we will use an example value:
<code><a href="https://example.com/cello/releases/cello-1.0.tar.gz" class="bare">https://example.com/cello/releases/cello-1.0.tar.gz</a></code></p>
</div>
<div class="paragraph">
<p>We should note that this example URL has hard coded values in it that are
possible to change in the future and are potentially even likely to change such
as the release version <code>1.0</code>. We can simplify this by only needing to update
one field in the SPEC file and allowing it to be reused. we will use the value
<code><a href="https://example.com/%{name}/releases/%{name}-%{version}.tar.gz" class="bare">https://example.com/%{name}/releases/%{name}-%{version}.tar.gz</a></code> instead of
the hard coded examples string previously listed.</p>
</div>
<div class="paragraph">
<p>The next item is to provide a listing for the <code>.patch</code> file we created earlier
such that we can apply it to the code later in the <code>%prep</code> section. We will
need a listing of <code>Patch0:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cello-output-first-patch.patch</code>.</p>
</div>
<div class="paragraph">
<p>After your edits, the top portion of your spec file should look like the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           cello
Version:        1.0
Release:        1%{?dist}
Summary:        Hello World example implemented in C

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz

Patch0:         cello-output-first-patch.patch</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next up we have <code>BuildRequires</code> and <code>Requires</code>, each of which define
something that is required by the package. However, <code>BuildRequires</code> is to tell
<code>rpmbuild</code> what is needed by your package at <strong>build</strong> time and <code>Requires</code>
is what is needed by your package at <strong>run</strong> time.</p>
</div>
<div class="paragraph">
<p>In this example we will need the <code>gcc</code> and <code>make</code> packages in order to
perform the compilation build process. Runtime requirements are fortunately
handled for us by <code>rpmbuild</code> because this program does not require anything
outside of the core
<a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>
standard libraries and we therefore will not need to
define anything by hand as a <code>Requires</code> and can omit that directive.</p>
</div>
<div class="paragraph">
<p>After your edits, the top portion of your spec file should look like the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           cello
Version:        0.1
Release:        1%{?dist}
Summary:        Hello World example implemented in C

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz

BuildRequires:  gcc
BuildRequires:  make</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following directives can be thought of as “section headings” because they
are directives that can define multi-line, multi-instruction, or scripted tasks
to occur. We will walk through them one by one just as we did with the previous
items.</p>
</div>
<div class="paragraph">
<p>The <code>%description</code> should be a longer, more full length description of the
software being packaged than what is found in the <code>Summary</code> directive. For the
sake of our example, this isn’t really going to contain much content but this
section can be a full paragraph or more than one paragraph if desired.</p>
</div>
<div class="paragraph">
<p>The <code>%prep</code> section is where we <em>prepare</em> our build environment or workspace
for building. Most often what happens here is the expansion of compressed
archives of the source code, application of patches, and potentially parsing of
information provided in the source code that is necessary in a later portion of
the SPEC. In this section we will simply use the provided macro <code>%setup -q</code>.</p>
</div>
<div class="paragraph">
<p>The <code>%build</code> section is where we tell the system how to actually build the
software we are packaging. Since wrote a simple <code>Makefile</code> for our
<a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>
implementation, we can simply use the <a href="http://www.gnu.org/software/make/">GNU make</a> command provided by
<code>rpmdev-newspec</code>. However, we need to remove the call to <code>%configure</code>
because we did not provide a
<a href="https://en.wikipedia.org/wiki/Configure_script">configure script</a>
. The <code>%build</code> section of our SPEC file should look as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%build
make %{?_smp_mflags}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>%install</code> section is where we instruct <code>rpmbuild</code> how to install our
previously built software into the <code>BUILDROOT</code> which is effectively a
<a href="https://en.wikipedia.org/wiki/Chroot">chroot</a>
base directory with nothing in it and we will have to construct any
paths or directory hierarchies that we will need in order to install our
software here in their specific locations. However, our RPM Macros help us
accomplish this task without having to hardcode paths.</p>
</div>
<div class="paragraph">
<p>Once again, since we have a simple <code>Makefile</code> the installation step can be
accomplished easily by leaving in place the <code>%make_install</code> macro that was
again provided for us by the <code>rpmdev-newspec</code> command.</p>
</div>
<div class="paragraph">
<p>The <code>%install</code> section should look like the following after your edits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%install
%make_install</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>%files</code> section is where we provide the list of files that this RPM
provides and where it’s intended for them to live on the system that the RPM is
installed upon. Note here that this isn’t relative to the <code>%{buildroot}</code> but
the full path for the files as they are expected to exist on the end system
after installation. Therefore, the listing for the <code>cello</code> file we are
installing will be <code>%{_bindir}/cello</code>.</p>
</div>
<div class="paragraph">
<p>Also, within this section you will sometimes need a built-in macro to provide
context on a file. This can be useful for Systems Administrators and end users
who might want to query the system with <code>rpm</code> about the resulting package.
The built-in macro we will use here is <code>%license</code> which will tell <code>rpmbuild</code>
that this is a software license file in the package file manifest metadata.</p>
</div>
<div class="paragraph">
<p>The <code>%files</code> section should look like the following after your edits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%files
%license LICENSE
%{_bindir}/%{name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last section, <code>%changelog</code> is a list of date-stamped entries that
correlate to a specific Version-Release of the package. This is not meant to be
a log of what changed in the software from release to release, but specifically
to packaging changes. For example, if software in a package needed patching or
there was a change needed in the build procedure listed in the <code>%build</code>
section that information would go here. Each change entry can contain multiple
items and each item should start on a new line and begin with a <code>-</code> character.
Below is our example entry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 0.1-1
- First cello package</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the format above, the date-stamp will begin with a <code>*</code> character,
followed by the calendar day of the week, the month, the day of the month, the
year, then the contact information for the RPM Packager. From there we have
a <code>-</code> character before the Version-Release, which is an often used convention
but not a requirement. Then finally the Version-Release.</p>
</div>
<div class="paragraph">
<p>That’s it! We’ve written an entire SPEC file for <strong>cello</strong>! In the next section
we will cover how to build the RPM!</p>
</div>
<div class="paragraph">
<p>The full SPEC file should now look like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           cello
Version:        1.0
Release:        1%{?dist}
Summary:        Hello World example implemented in C

License:        GPLv3+
URL:            https://www.example.com/%{name}
Source0:        https://www.example.com/%{name}/releases/%{name}-%{version}.tar.gz

Patch0:         cello-output-first-patch.patch

BuildRequires:  gcc
BuildRequires:  make

%description
The long-tail description for our Hello World Example implemented in
C.

%prep
%setup -q

%patch0

%build
make %{?_smp_mflags}

%install
%make_install

%files
%license LICENSE
%{_bindir}/%{name}

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 1.0-1
- First cello package</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>rpmdevtools</code> package provides a set of SPEC file templates for several
popular languages in the <code>/etc/rpmdevtools/</code> directory.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="building-rpms">Building RPMS</h3>
<div class="paragraph">
<p>RPMs are built with the <code>rpmbuild</code> command. Different scenarios and desired
outcomes require different combinations of arguments to <code>rpmbuild</code>. This
section describes the two prime scenarios:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>building a source RPM</p>
</li>
<li>
<p>building a binary RPM</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>rpmbuild</code> command expects a certain directory and file structure. This is
the same structure as set up by the <code>rpmdev-setuptree</code> utility. The previous
instructions also confirmed to the required structure.</p>
</div>
<div class="sect3">
<h4 id="source-rpms">Source RPMs</h4>
<div class="paragraph">
<p>Why build a Source RPM (SRPM)?</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To preserve the exact source of a certain Name-Version-Release of the RPM that
was deployed to an environment. This includes the exact SPEC file, the source
code, and all relevant patches. This is useful for looking back in history and
for debugging.</p>
</li>
<li>
<p>To be able to build a binary RPM on a different hardware platform or
<a href="https://en.wikipedia.org/wiki/Microarchitecture">architecture</a>.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="create-source-rpms">To create a SRPM:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild -bs _SPECFILE_</code></pre>
</div>
</div>
<div class="paragraph">
<p>Substitute <em>SPECFILE</em> with the SPEC file. The <code>-bs</code> option stands for "build
source".</p>
</div>
<div class="paragraph">
<p>Here we build SRPMs for <code>bello</code>, <code>pello</code>, and <code>cello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd ~/rpmbuild/SPECS/

$ rpmbuild -bs bello.spec
Wrote: /home/admiller/rpmbuild/SRPMS/bello-0.1-1.el7.src.rpm

$ rpmbuild -bs pello.spec
Wrote: /home/admiller/rpmbuild/SRPMS/pello-0.1.1-1.el7.src.rpm

$ rpmbuild -bs cello.spec
Wrote: /home/admiller/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that SRPMs were placed into the <code>rpmbuild/SRPMS</code> directory, which is part
of the structure expected by <code>rpmbuild</code>.</p>
</div>
<div class="paragraph">
<p>This is all there is to building a SRPM.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="binary-rpms">Binary RPMS</h4>
<div class="paragraph">
<p>There are two methods for building Binary RPMs:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Rebuilding it from a SRPM using the <code>rpmbuild --rebuild</code> command.</p>
</li>
<li>
<p>Building it from a SPEC file using the <code>rpmbuild -bb</code> command. The <code>-bb</code> option stands for "build binary".</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="rebuild">Rebuilding from a Source RPM</h5>
<div class="paragraph">
<p>To rebuild <code>bello</code>, <code>pello</code>, and <code>cello</code> from Source RPMs (SRPMs), run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild --rebuild ~/rpmbuild/SRPMS/bello-0.1-1.el7.src.rpm
[output truncated]

$ rpmbuild --rebuild ~/rpmbuild/SRPMS/pello-0.1.1-1.el7.src.rpm
[output truncated]

$ rpmbuild --rebuild ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
[output truncated]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you have built RPMs. A few notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The output generated when creating a binary RPM is verbose, which is helpful
for debugging. The output varies for different examples and corresponds to their
SPEC files.</p>
</li>
<li>
<p>The resulting binary RPMs are in <code>~/rpmbuild/RPMS/YOURARCH</code> where <code>YOURARCH</code>
is your
<a href="https://en.wikipedia.org/wiki/Microarchitecture">architecture</a>
or in
<code>~/rpmbuild/RPMS/noarch/</code>, if the package is not architecture-specific.</p>
</li>
<li>
<p>Invoking <code>rpmbuild --rebuild</code> involves:</p>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Installing the contents of the SRPM - the SPEC file and the source code - into the <code>~/rpmbuild/</code> directory.</p>
</li>
<li>
<p>Building using the installed contents.</p>
</li>
<li>
<p>Removing the SPEC file and the source code.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>You can retain the SPEC file and the source code after building. For this, you
have two options:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>When building, use the <code>--recompile</code> option instead of <code>--rebuild</code>.</p>
</li>
<li>
<p>Install the SRPMs using these commands:</p>
</li>
</ul>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -Uvh ~/rpmbuild/SRPMS/bello-0.1-1.el7.src.rpm
Updating / installing...
   1:bello-0.1-1.el7                  ################################# [100%]

$ rpm -Uvh ~/rpmbuild/SRPMS/pello-0.1.1-1.el7.src.rpm
Updating / installing...
   1:pello-0.1.1-1.el7                ################################# [100%]

$ rpm -Uvh ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
Updating / installing...
   1:cello-1.0-1.el7                  ################################# [100%]</code></pre>
</div>
</div>
<div class="paragraph">
<p>For this tutorial, execute the <code>rpm -Uvh</code> commands above to continue
interacting with the SPEC files and sources.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="build-binary">Building Binary from the SPEC file</h5>
<div class="paragraph">
<p>To build <code>bello</code>, <code>pello</code>, and <code>cello</code> from their SPEC files, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild -bb ~/rpmbuild/SPECS/bello.spec

$ rpmbuild -bb ~/rpmbuild/SPECS/pello.spec

$ rpmbuild -bb ~/rpmbuild/SPECS/cello.spec</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you have built RPMs from SPEC files.</p>
</div>
<div class="paragraph">
<p>Most of the information in <a href="#rebuild">Rebuilding from a Source RPM</a> apply here.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="checking-rpms-for-sanity">Checking RPMs For Sanity</h3>
<div class="paragraph">
<p>After creating a package, it is good to check its quality. Quality of the
package, not of the software delivered within it. The main tool for this is
<a href="https://github.com/rpm-software-management/rpmlint">rpmlint</a>. It improves RPM
maintainability and enables sanity and error checking by performing static
analysis of the RPM. This utility can check Binary RPMs, Source RPMs (SRPMs),
and SPEC files, so is useful for all stages of packaging, as shown in the
following examples.</p>
</div>
<div class="paragraph">
<p>Note that <code>rpmlint</code> has very strict guidelines, and sometimes it is acceptable
and necessary to skip some of its Errors and Warnings, as shown in the following
examples.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In the examples, we run <code>rpmlint</code> without any options, which produces
non-verbose output. For detailed explanations of each Error or Warning, run
<code>rpmlint -i</code> instead.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="checking-bello-spec-file">Checking the bello SPEC File</h4>
<div class="paragraph">
<p>This is the output of running <code>rpmlint</code> on the SPEC file for <code>bello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint bello.spec
bello.spec: W: invalid-url Source0: https://www.example.com/bello/releases/bello-0.1.tar.gz HTTP Error 404: Not Found
0 packages and 1 specfiles checked; 0 errors, 1 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Observations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For <code>bello.spec</code> there is only one warning. It says that the URL listed in the
<code>Source0</code> directive is unreachable. This is expected, because the specified
<code>example.com</code> URL does not exist. Presuming that we expect this URL to work in
the future, we can ignore this warning.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is the output of running <code>rpmlint</code> on the SRPM for <code>bello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/SRPMS/bello-0.1-1.el7.src.rpm
bello.src: W: invalid-url URL: https://www.example.com/bello HTTP Error 404: Not Found
bello.src: W: invalid-url Source0: https://www.example.com/bello/releases/bello-0.1.tar.gz HTTP Error 404: Not Found
1 packages and 0 specfiles checked; 0 errors, 2 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Observations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For the <code>bello</code> SRPM there is a new warning, which says that the URL
specified in the <code>URL</code> directive is unreachable. Assuming the link will be
working in the future, we can ignore this warning.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="checking-bello-binary-rpm">Checking the bello Binary RPM</h4>
<div class="paragraph">
<p>When checking Binary RPMs, <code>rpmlint</code> checks for more things, including:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>documentation</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Man_page">manual pages</a></p>
</li>
<li>
<p>consistent use of the <a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Filesystem Hierarchy Standard</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This is the output of running <code>rpmlint</code> on the Binary RPM for <code>bello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/RPMS/noarch/bello-0.1-1.el7.noarch.rpm
bello.noarch: W: invalid-url URL: https://www.example.com/bello HTTP Error 404: Not Found
bello.noarch: W: no-documentation
bello.noarch: W: no-manual-page-for-binary bello
1 packages and 0 specfiles checked; 0 errors, 3 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Observations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>no-documentation</code> and <code>no-manual-page-for-binary</code> warnings say that
the RPM has no documentation or manual pages, because we did not provide any.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Apart from the above warnings, our RPM is passing <code>rpmlint</code> checks.</p>
</div>
</div>
<div class="sect3">
<h4 id="checking-pello-spec-file">Checking the pello SPEC File</h4>
<div class="paragraph">
<p>This is the output of running <code>rpmlint</code> on the SPEC file for <code>pello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint pello.spec
pello.spec:30: E: hardcoded-library-path in %{buildroot}/usr/lib/%{name}
pello.spec:34: E: hardcoded-library-path in /usr/lib/%{name}/%{name}.pyc
pello.spec:39: E: hardcoded-library-path in %{buildroot}/usr/lib/%{name}/
pello.spec:43: E: hardcoded-library-path in /usr/lib/%{name}/
pello.spec:45: E: hardcoded-library-path in /usr/lib/%{name}/%{name}.py*
pello.spec: W: invalid-url Source0: https://www.example.com/pello/releases/pello-0.1.1.tar.gz HTTP Error 404: Not Found
0 packages and 1 specfiles checked; 5 errors, 1 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Observations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>invalid-url Source0</code> warning says that the URL listed in the Source0
directive is unreachable. This is expected, because the specified <code>example.com</code>
URL does not exist. Presuming that we expect this URL to work in the future, we
can ignore this warning.</p>
</li>
<li>
<p>There are many errors, because we intentionally wrote this SPEC file to be
uncomplicated and to show what errors <code>rpmlint</code> can report.</p>
</li>
<li>
<p>The <code>hardcoded-library-path</code> errors suggest to use the <code>%{_libdir}</code> macro
instead of hard-coding the library path. For the sake of this example, we ignore
these errors, but for packages going in production you need a good reason for
ignoring this error.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is the output of running <code>rpmlint</code> on the SRPM for <code>pello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/SRPMS/pello-0.1.1-1.el7.src.rpm
pello.src: W: invalid-url URL: https://www.example.com/pello HTTP Error 404: Not Found
pello.src:30: E: hardcoded-library-path in %{buildroot}/usr/lib/%{name}
pello.src:34: E: hardcoded-library-path in /usr/lib/%{name}/%{name}.pyc
pello.src:39: E: hardcoded-library-path in %{buildroot}/usr/lib/%{name}/
pello.src:43: E: hardcoded-library-path in /usr/lib/%{name}/
pello.src:45: E: hardcoded-library-path in /usr/lib/%{name}/%{name}.py*
pello.src: W: invalid-url Source0: https://www.example.com/pello/releases/pello-0.1.1.tar.gz HTTP Error 404: Not Found
1 packages and 0 specfiles checked; 5 errors, 2 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Observations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The new <code>invalid-url URL</code> error here is about the <code>URL</code> directive, which
is unreachable. Assuming that we expect the URL to become valid in the future,
we can ignore this error.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="checking-pello-binary-rpm">Checking the pello Binary RPM</h4>
<div class="paragraph">
<p>When checking Binary RPMs, <code>rpmlint</code> checks for more things, including:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>documentation</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Man_page">manual pages</a></p>
</li>
<li>
<p>consistent use of the</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Filesystem Hierarchy Standard</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This is the output of running <code>rpmlint</code> on the Binary RPM for <code>pello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/RPMS/noarch/pello-0.1.1-1.el7.noarch.rpm
pello.noarch: W: invalid-url URL: https://www.example.com/pello HTTP Error 404: Not Found
pello.noarch: W: only-non-binary-in-usr-lib
pello.noarch: W: no-documentation
pello.noarch: E: non-executable-script /usr/lib/pello/pello.py 0644L /usr/bin/env
pello.noarch: W: no-manual-page-for-binary pello
1 packages and 0 specfiles checked; 1 errors, 4 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Observations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>no-documentation</code> and <code>no-manual-page-for-binary</code> warnings say that
the RPM has no documentation or manual pages, because we did not provide any.</p>
</li>
<li>
<p>The <code>only-non-binary-in-usr-lib</code> warning says that you provided only
non-binary artifacts in <code>/usr/lib/</code>. This directory is normally reserved for
shared object files, which are binary files. Therefore, <code>rpmlint</code> expects at
least one or more files in <code>/usr/lib/</code> to be binary.</p>
<div class="paragraph">
<p>This is an example of an <code>rpmlint</code> check for compliance with
<a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Filesystem Hierarchy Standard</a>
.</p>
</div>
<div class="paragraph">
<p>Normally, use RPM macros to ensure the correct placement of files. For the sake
of this example, we can ignore this warning.</p>
</div>
</li>
<li>
<p>The <code>non-executable-script</code> error warns that the <code>/usr/lib/pello/pello.py</code>
file has no execute permissions. Since this file contains the
<a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a>
, <code>rpmlint</code> expects
the file to be executable. For the purpose of the example, leave this file
without execute permissions and ignore this error.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Apart from the above warnings and errors, our RPM is passing <code>rpmlint</code> checks.</p>
</div>
</div>
<div class="sect3">
<h4 id="checking-cello-spec-file">Checking the cello SPEC File</h4>
<div class="paragraph">
<p>This is the output of running <code>rpmlint</code> on the SPEC file for <code>cello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/SPECS/cello.spec
/home/admiller/rpmbuild/SPECS/cello.spec: W: invalid-url Source0: https://www.example.com/cello/releases/cello-1.0.tar.gz HTTP Error 404: Not Found
0 packages and 1 specfiles checked; 0 errors, 1 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Observations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The only warning for <code>cello.spec</code> says that the URL listed in the
<code>Source0</code> directive is unreachable. This is expected, because the specified
<code>example.com</code> URL does not exist. Presuming that we expect this URL to work in
the future, we can ignore this warning.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is the output of running <code>rpmlint</code> on the SRPM file for <code>cello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
cello.src: W: invalid-url URL: https://www.example.com/cello HTTP Error 404: Not Found
cello.src: W: invalid-url Source0: https://www.example.com/cello/releases/cello-1.0.tar.gz HTTP Error 404: Not Found
1 packages and 0 specfiles checked; 0 errors, 2 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Observations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For the <code>cello</code> SRPM there is a new warning, which says that the URL
specified in the <code>URL</code> directive is unreachable. Assuming the link will be
working in the future, we can ignore this warning.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="checking-cello-binary-rpm">Checking the cello Binary RPM</h4>
<div class="paragraph">
<p>When checking Binary RPMs, <code>rpmlint</code> checks for more things, including:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>documentation</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Man_page">manual pages</a></p>
</li>
<li>
<p>consistent use of the
<a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Filesystem Hierarchy Standard</a>
.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This is the output of running <code>rpmlint</code> on the Binary RPM for <code>cello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/RPMS/x86_64/cello-1.0-1.el7.x86_64.rpm
cello.x86_64: W: invalid-url URL: https://www.example.com/cello HTTP Error 404: Not Found
cello.x86_64: W: no-documentation
cello.x86_64: W: no-manual-page-for-binary cello
1 packages and 0 specfiles checked; 0 errors, 3 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Observations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>no-documentation</code> and <code>no-manual-page-for-binary</code> warnings say that
the RPM has no documentation or manual pages, because we did not provide any.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Apart from the above warnings and errors, our RPM is passing <code>rpmlint</code> checks.</p>
</div>
<div class="paragraph">
<p>Our RPMs are now ready and checked with <code>rpmlint</code>. This concludes the
tutorial. For more information on packaging RPMs, proceed to
<a href="#advanced-topics">Advanced Topics</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced-topics">Advanced Topics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter covers topics that are beyond the scope of the introductory
tutorial but are often useful in real-world RPM packaging.</p>
</div>
<div class="sect2">
<h3 id="Signing-Packages">Signing Packages</h3>
<div class="paragraph">
<p>Signing a package is a way to secure the package for an end user. Secure
transport can be achieved with implementation of the HTTPS protocol, which can
be done when the package is downloaded just before installing. However, the
packages are often downloaded in advance and stored in local repositories before
they are used. The packages are signed to make sure no third party can alter the
content of a package.</p>
</div>
<div class="paragraph">
<p>There are three ways to sign a package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Adding-a-Signature-to-a-Package">Adding a signature to an already existing
package</a>.</p>
</li>
<li>
<p><a href="#Replacing-a-Package-Signature">Replacing the signature on an already
existing package</a>.</p>
</li>
<li>
<p><a href="#Build-time-Signing">Signing a package at build-time</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="Adding-a-Signature-to-a-Package">Adding a Signature to a Package</h4>
<div class="paragraph">
<p>In most cases packages are built without a signature. The signature is added
just before the release of the package.</p>
</div>
<div class="paragraph">
<p>In order to add another signature to the package package, use the <code>--addsign</code>
option. Having more than one signature makes it possible to record the package&#8217;s
path of ownership from the package builder to the end-user.</p>
</div>
<div class="paragraph">
<p>As an example, a division of a company creates a package and signs it with the
division&#8217;s key. The company&#8217;s headquarters then checks the package&#8217;s signature
and adds the corporate signature to the package, stating that the signed package
is authentic.</p>
</div>
<div class="paragraph">
<p>With two signatures, the package makes its way to a retailer. The retailer
checks the signatures and, if they check out, adds their signature as well.</p>
</div>
<div class="paragraph">
<p>The package now makes its way to a company that wishes to deploy the package.
After checking every signature on the package, they know that it is an authentic
copy, unchanged since it was first created. Depending on the deploying company&#8217;s
internal controls, they may choose to add their own signature, to reassure their
employees that the package has received their corporate approval.</p>
</div>
<div class="paragraph">
<p>The output from the <code>--addsign</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --addsign blather-7.9-1.i386.rpm
            Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:</code></pre>
</div>
</div>
<div class="paragraph">
<p>To check the signatures of a package with multiple signatures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --checksig blather-7.9-1.i386.rpm
blather-7.9-1.i386.rpm: size pgp pgp md5 OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>The two <code>pgp</code> strings in the output of the <code>rpm --checksig</code> command show that
the package has been signed twice.</p>
</div>
<div class="paragraph">
<p>RPM makes it possible to add the same signature multiple times. The <code>--addsign</code>
option does not check for multiple identical signatures.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --addsig blather-7.9-1.i386.rpm
              Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:
$ rpm --addsig blather-7.9-1.i386.rpm
              Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:
$ rpm --addsig blather-7.9-1.i386.rpm
              Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:
$ rpm --checksig blather-7.9-1.i386.rpm
blather-7.9-1.i386.rpm: size pgp pgp pgp pgp md5 OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the <code>rpm --checksig</code> command displays four signatures.</p>
</div>
</div>
<div class="sect3">
<h4 id="Replacing-a-Package-Signature">Replacing a Package Signature</h4>
<div class="paragraph">
<p>To change the public key without having to rebuild each package, use the
<code>--resign</code> option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --resign blather-7.9-1.i386.rpm
            Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use the <code>--resign</code> option on multiple package files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --resign b*.rpm
            Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:
bother-3.5-1.i386.rpm:</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Build-time-Signing">Build-time Signing</h4>
<div class="paragraph">
<p>To sign a package at build-time, use the <code>rpmbuild</code> command with the <code>--sign</code>
option. This requires entering the PGP passphrase.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild -ba --sign blather-7.9.spec
            Enter pass phrase:

Pass phrase is good.
* Package: blather
…
Binary Packaging: blather-7.9-1
Finding dependencies...
…
Generating signature: 1002
Wrote: /usr/src/redhat/RPMS/i386/blather-7.9-1.i386.rpm
…
Source Packaging: blather-7.9-1
…
Generating signature: 1002
Wrote: /usr/src/redhat/SRPMS/blather-7.9-1.src.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>The "Generating signature" message appears in both the binary and source
packaging sections. The number following the message indicates that the
signature added was created using PGP.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When using the <code>--sign</code> option for <code>rpmbuild</code>, use only <code>-bb</code> or <code>-ba</code> options
for package building. <code>-ba</code> option mean build binary <strong>and</strong> source packages.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To verify the signature of a package, use the <code>rpm</code> command with <code>--checksig</code>
option. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --checksig blather-7.9-1.i386.rpm
blather-7.9-1.i386.rpm: size pgp md5 OK</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="Building-Multiple-Packages">Building Multiple Packages</h5>
<div class="paragraph">
<p>When building multiple packages, use the following syntax to avoid entering the
PGP passphrase multiple times. For example when building the <code>blather</code> and
<code>bother</code> packages, sign them by using the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild -ba --sign b*.spec
              Enter pass phrase:

Pass phrase is good.
* Package: blather
…
Binary Packaging: blather-7.9-1
…
Generating signature: 1002
Wrote: /usr/src/redhat/RPMS/i386/blather-7.9-1.i386.rpm
…
Source Packaging: blather-7.9-1
…
Generating signature: 1002
Wrote: /usr/src/redhat/SRPMS/blather-7.9-1.src.rpm
…
* Package: bother
…
Binary Packaging: bother-3.5-1
…
Generating signature: 1002
Wrote: /usr/src/redhat/RPMS/i386/bother-3.5-1.i386.rpm
…
Source Packaging: bother-3.5-1
…
Generating signature: 1002
Wrote: /usr/src/redhat/SRPMS/bother-3.5-1.src.rpm</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mock">Mock</h3>
<div class="paragraph">
<p><a href="https://github.com/rpm-software-management/mock/wiki">Mock</a> is a tool for
building packages. It can build packages for different architectures and
different Fedora or RHEL versions than the build host has. Mock creates chroots
and builds packages in them. Its only task is to reliably populate a chroot and
attempt to build a package in that chroot.</p>
</div>
<div class="paragraph">
<p>Mock also offers a multi-package tool, <code>mockchain</code>, that can build chains of
packages that depend on each other.</p>
</div>
<div class="paragraph">
<p>Mock is capable of building SRPMs from source configuration management if the
<code>mock-scm</code> package is present, then building the SRPM into RPMs. See –scm-enable
in the documentation. (From the upstream documentation)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In order to use <a href="https://github.com/rpm-software-management/mock/wiki">Mock</a>
on a RHEL or CentOS system, you will need to enable the “Extra Packages for
Enterprise Linux” (<a href="https://fedoraproject.org/wiki/EPEL">EPEL</a>) repository. This
is a repository provided by the <a href="https://getfedora.org/">Fedora</a> community and has
many useful tools for RPM Packagers, systems administrators, and developers.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One of the most common use cases RPM Packagers have for
<a href="https://github.com/rpm-software-management/mock/wiki">Mock</a> is to create what is
known as a “pristine build environment”. By using mock as a “pristine build
environment”, nothing about the current state of your system affects the RPM
Package itself. Mock uses different configurations to specify what the build
“target” is, these are found on your system in the <code>/etc/mock/</code> directory
(once you’ve installed the <code>mock</code> package). You can build for different
distributions or releases just by specifying it on the command line. Something
to keep in mind is that the configuration files that come with <code>mock</code> are
targeted at Fedora RPM Packagers, and as such RHEL and CentOS release versions
are labeled as “epel” because that is the “target” repository these RPMs would
be built for. You simply specify the configuration you want to use (minus the
<code>.cfg</code> file extension). For example, you could build our <code>cello</code> example for
both RHEL 7 and Fedora 23 using the following commands without ever having to
use different machines.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mock -r epel-7-x86_64 ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm

$ mock -r fedora-23-x86_64 ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>One example of why you might want to use <code>mock</code> is if you were packaging RPMs on
your laptop and you had a package installed (we’ll call it <code>foo</code> for this
example) that was a <code>BuildRequires</code> of that package you were creating but
forgot to actually make the <code>BuildRequires: foo</code> entry. The build would
succeed when you run <code>rpmbuild</code> because <code>foo</code> was needed to build and it was
found on the system at build time. However, if you took the SRPM to another
system that lacked <code>foo</code> it would fail, causing an unexpected side effect.
<a href="https://github.com/rpm-software-management/mock/wiki">Mock</a> solves this by first
parsing the contents of the SRPM and installing the <code>BuildRequires</code> into its
<a href="https://en.wikipedia.org/wiki/Chroot">chroot</a> which means that if you were
missing the <code>BuildRequires</code> entry, the build would fail because <code>mock</code> would
not know to install it and it would therefore not be present in the buildroot.</p>
</div>
<div class="paragraph">
<p>Another example is the opposite scenario, let’s say you need <code>gcc</code> to build a
package but don’t have it installed on your system (which is unlikely as an RPM
Packager, but just for the sake of the example let us pretend that is true).
With <a href="https://github.com/rpm-software-management/mock/wiki">Mock</a>, you don’t have
to install <code>gcc</code> on your system because it will get installed in the chroot as
part of <code>mock</code>’s process.</p>
</div>
<div class="paragraph">
<p>Below is an example of attempting to rebuild a package that has a dependency
that I’m missing on my system. The key thing to note is that while <code>gcc</code> is
commonly on most RPM Packager’s systems, some RPM Packages can have over a dozen
<code>BuildRequires</code> and this allows you to not need to clutter up your workstation
with otherwise un-needed or un-necessary packages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild --rebuild ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
Installing /home/admiller/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
error: Failed build dependencies: gcc is needed by cello-1.0-1.el7.x86_64

$ mock -r epel-7-x86_64 ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
INFO: mock.py version 1.2.17 starting (python version = 2.7.5)...
Start: init plugins
INFO: selinux enabled
Finish: init plugins
Start: run
INFO: Start(/home/admiller/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm)  Config(epel-7-x86_64)
Start: clean chroot
Finish: clean chroot
Start: chroot init
INFO: calling preinit hooks
INFO: enabled root cache
Start: unpacking root cache
Finish: unpacking root cache
INFO: enabled yum cache
Start: cleaning yum metadata
Finish: cleaning yum metadata
Mock Version: 1.2.17
INFO: Mock Version: 1.2.17
Start: yum update
base                                                                    | 3.6 kB  00:00:00
epel                                                                    | 4.3 kB  00:00:00
extras                                                                  | 3.4 kB  00:00:00
updates                                                                 | 3.4 kB  00:00:00
No packages marked for update
Finish: yum update
Finish: chroot init
Start: build phase for cello-1.0-1.el7.src.rpm
Start: build setup for cello-1.0-1.el7.src.rpm
warning: Could not canonicalize hostname: rhel7
Building target platforms: x86_64
Building for target x86_64
Wrote: /builddir/build/SRPMS/cello-1.0-1.el7.centos.src.rpm
Getting requirements for cello-1.0-1.el7.centos.src
 --&gt; Already installed : gcc-4.8.5-4.el7.x86_64
 --&gt; Already installed : 1:make-3.82-21.el7.x86_64
No uninstalled build requires
Finish: build setup for cello-1.0-1.el7.src.rpm
Start: rpmbuild cello-1.0-1.el7.src.rpm
Building target platforms: x86_64
Building for target x86_64
Executing(%prep): /bin/sh -e /var/tmp/rpm-tmp.v9rPOF
+ umask 022
+ cd /builddir/build/BUILD
+ cd /builddir/build/BUILD
+ rm -rf cello-1.0
+ /usr/bin/gzip -dc /builddir/build/SOURCES/cello-1.0.tar.gz
+ /usr/bin/tar -xf -
+ STATUS=0
+ '[' 0 -ne 0 ']'
+ cd cello-1.0
+ /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w .
Patch #0 (cello-output-first-patch.patch):
+ echo 'Patch #0 (cello-output-first-patch.patch):'
+ /usr/bin/cat /builddir/build/SOURCES/cello-output-first-patch.patch
patching file cello.c
+ /usr/bin/patch -p0 --fuzz=0
+ exit 0
Executing(%build): /bin/sh -e /var/tmp/rpm-tmp.UxRVtI
+ umask 022
+ cd /builddir/build/BUILD
+ cd cello-1.0
+ make -j2
gcc -g -o cello cello.c
+ exit 0
Executing(%install): /bin/sh -e /var/tmp/rpm-tmp.K3i2dL
+ umask 022
+ cd /builddir/build/BUILD
+ '[' /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64 '!=' / ']'
+ rm -rf /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
++ dirname /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
+ mkdir -p /builddir/build/BUILDROOT
+ mkdir /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
+ cd cello-1.0
+ /usr/bin/make install DESTDIR=/builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
mkdir -p /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/bin
install -m 0755 cello /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/bin/cello
+ /usr/lib/rpm/find-debuginfo.sh --strict-build-id -m --run-dwz --dwz-low-mem-die-limit 10000000 --dwz-max-die-limit 110000000 /builddir/build/BUILD/cello-1.0
extracting debug info from /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/bin/cello
dwz: Too few files for multifile optimization
/usr/lib/rpm/sepdebugcrcfix: Updated 0 CRC32s, 1 CRC32s did match.
+ /usr/lib/rpm/check-buildroot
+ /usr/lib/rpm/redhat/brp-compress
+ /usr/lib/rpm/redhat/brp-strip-static-archive /usr/bin/strip
+ /usr/lib/rpm/brp-python-bytecompile /usr/bin/python 1
+ /usr/lib/rpm/redhat/brp-python-hardlink
+ /usr/lib/rpm/redhat/brp-java-repack-jars
Processing files: cello-1.0-1.el7.centos.x86_64
Executing(%license): /bin/sh -e /var/tmp/rpm-tmp.vxtAuO
+ umask 022
+ cd /builddir/build/BUILD
+ cd cello-1.0
+ LICENSEDIR=/builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/share/licenses/cello-1.0
+ export LICENSEDIR
+ /usr/bin/mkdir -p /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/share/licenses/cello-1.0
+ cp -pr LICENSE /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/share/licenses/cello-1.0
+ exit 0
Provides: cello = 1.0-1.el7.centos cello(x86-64) = 1.0-1.el7.centos
Requires(rpmlib): rpmlib(CompressedFileNames) &lt;= 3.0.4-1 rpmlib(FileDigests) &lt;= 4.6.0-1 rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1
Requires: libc.so.6()(64bit) libc.so.6(GLIBC_2.2.5)(64bit) rtld(GNU_HASH)
Processing files: cello-debuginfo-1.0-1.el7.centos.x86_64
Provides: cello-debuginfo = 1.0-1.el7.centos cello-debuginfo(x86-64) = 1.0-1.el7.centos
Requires(rpmlib): rpmlib(FileDigests) &lt;= 4.6.0-1 rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1 rpmlib(CompressedFileNames) &lt;= 3.0.4-1
Checking for unpackaged file(s): /usr/lib/rpm/check-files /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
Wrote: /builddir/build/RPMS/cello-1.0-1.el7.centos.x86_64.rpm
warning: Could not canonicalize hostname: rhel7
Wrote: /builddir/build/RPMS/cello-debuginfo-1.0-1.el7.centos.x86_64.rpm
Executing(%clean): /bin/sh -e /var/tmp/rpm-tmp.JuPOtY
+ umask 022
+ cd /builddir/build/BUILD
+ cd cello-1.0
+ /usr/bin/rm -rf /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
+ exit 0
Finish: rpmbuild cello-1.0-1.el7.src.rpm
Finish: build phase for cello-1.0-1.el7.src.rpm
INFO: Done(/home/admiller/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm) Config(epel-7-x86_64) 0 minutes 16 seconds
INFO: Results and/or logs in: /var/lib/mock/epel-7-x86_64/result
Finish: run</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, <code>mock</code> is a fairly verbose tool. You will also notice a lot of
<a href="http://yum.baseurl.org/">yum</a> or
<a href="https://github.com/rpm-software-management/dnf">dnf</a> output (depending on RHEL7,
CentOS7, or Fedora mock target) that is not found in this output which was
omitted for brevity and is often omitted after you have done an <code>--init</code> on a
mock target, such as <code>mock -r epel-7-x86_64 --init</code> which will pre-download
all the required packages, cache them, and pre-stage the build chroot.</p>
</div>
<div class="paragraph">
<p>For more information, please consult the
<a href="https://github.com/rpm-software-management/mock/wiki">Mock</a> upstream
documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="version-control-systems">Version Control Systems</h3>
<div class="paragraph">
<p>When working with RPMs, it is often desireable to utilize a
<a href="https://en.wikipedia.org/wiki/Version_control">Version Control System</a> (VCS) such
as <a href="https://git-scm.com/">git</a> for managing components of the software we are
packaging. Something to note is that storing binary files in a VCS is not
favorable because it will drastically inflate the size of the source repository
as these tools are engineered to handle differentials in files (often optimized
for text files) and this is not something that binary files lend themselves to
so normally each whole binary file is stored. As a side effect of this there are
some clever utilities that are popular among upstream Open Source projects that
work around this problem by either storing the SPEC file where the source code
is in a VCS (i.e. - it is not in a compressed archive for redistribution) or
place only the SPEC file and patches in the VCS and upload the compressed
archive of the upstream release source to what is called a “look aside cache”.</p>
</div>
<div class="paragraph">
<p>In this section we will cover two different options for using a VCS system,
<a href="https://git-scm.com/">git</a>, for managing the contents that will ultimately be
turned into a RPM package. One is called <a href="https://github.com/dgoodwin/tito">tito</a>
and the other is <a href="https://github.com/release-engineering/dist-git">dist-git</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For the duration of this section you will need to install the <code>git</code>
package on you system in order to follow along.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="tito">tito</h4>
<div class="paragraph">
<p>Tito is an utility that assumes all the source code for the software that is
going to be packaged is already in a <a href="https://git-scm.com/">git</a> source control
repository. This is good for those practicing a DevOps workflow as it allows for
the team writing the software to maintain their normal
<a href="https://git-scm.com/book/en/v2/Git-Branching-Branching-Workflows">Branching
Workflow</a>. Tito will then allow for the software to be incrementally packaged,
built in an automated fashion, and still provide a native installation
experience for <a href="http://rpm.org/">RPM</a> based systems.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <a href="https://github.com/dgoodwin/tito">tito</a> package is available in
<a href="https://getfedora.org/">Fedora</a> as well as in the
<a href="https://fedoraproject.org/wiki/EPEL">EPEL</a> repository for use on RHEL 7 and
CentOS 7.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Tito operates based on <a href="https://git-scm.com/book/en/v2/Git-Basics-Tagging">git
tags</a> and will manage tags for you if you elect to allow it, but can optionally
operate under whatever tagging scheme you prefer as this functionality is
configurable.</p>
</div>
<div class="paragraph">
<p>Let’s explore a little bit about tito by looking at an upstream project already
using it. We will actually be using the upstream git repository of the project
that is our next section’s subject,
<a href="https://github.com/release-engineering/dist-git">dist-git</a>. Since this project is
publicly hosted on <a href="https://github.com/">GitHub</a>, let’s go ahead and clone the git
repo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ git clone https://github.com/release-engineering/dist-git.git
Cloning into 'dist-git'...
remote: Counting objects: 425, done.
remote: Total 425 (delta 0), reused 0 (delta 0), pack-reused 425
Receiving objects: 100% (425/425), 268.76 KiB | 0 bytes/s, done.
Resolving deltas: 100% (184/184), done.
Checking connectivity... done.

$ cd dist-git/

$ ls *.spec
dist-git.spec

$ tree rel-eng/
rel-eng/
├── packages
│   └── dist-git
└── tito.props

1 directory, 2 files</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we can see here, the spec file is at the root of the git repository and there
is a <code>rel-eng</code> directory in the repository which is used by tito for general
book keeping, configuration, and various advanced topics like custom tito
modules. We can see in the directory layout that there is a sub-directory
entitled <code>packages</code> which will store a file per package that tito manages in
the repository as you can have many RPMs in a single git repository and tito
will handle that just fine. In this scenario however, we see only a single
package listing and it should be noted that it matches the name of our spec
file. All of this is setup by the command <code>tito init</code> when the developers of
<a href="https://github.com/release-engineering/dist-git">dist-git</a> first initialized
their git repo to be managed by tito.</p>
</div>
<div class="paragraph">
<p>If we were to follow a common workflow of a DevOps Practitioner then we would
likely want to use this as part of a
<a href="https://en.wikipedia.org/wiki/Continuous_integration">Continuous Integration</a>
(CI) or <a href="https://en.wikipedia.org/wiki/Continuous_delivery">Continuous Delivery</a>
(CD) process. What we can do in that scenario is perform what is known as a
“test build” to tito, we can even use mock to do this. We could then use the
output as the installation point for some other component in the pipeline. Below
is a simple example of commands that could accomplish this and they could be
adapted to other environments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ tito build --test --srpm
Building package [dist-git-0.13-1]
Wrote: /tmp/tito/dist-git-git-0.efa5ab8.tar.gz

Wrote: /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.fc23.src.rpm

$ tito build --builder=mock --arg mock=epel-7-x86_64 --test --rpm
Building package [dist-git-0.13-1]
Creating rpms for dist-git-git-0.efa5ab8 in mock: epel-7-x86_64
Wrote: /tmp/tito/dist-git-git-0.efa5ab8.tar.gz

Wrote: /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.fc23.src.rpm

Using srpm: /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.fc23.src.rpm
Initializing mock...
Installing deps in mock...
Building RPMs in mock...
Wrote:
  /tmp/tito/dist-git-selinux-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm
  /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm

$ sudo yum localinstall /tmp/tito/dist-git-*.noarch.rpm
Loaded plugins: product-id, search-disabled-repos, subscription-manager
Examining /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm: dist-git-0.13-1.git.0.efa5ab8.el7.centos.noarch
Marking /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm to be installed
Examining /tmp/tito/dist-git-selinux-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm: dist-git-selinux-0.13-1.git.0.efa5ab8.el7.centos.noarch
Marking /tmp/tito/dist-git-selinux-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm to be installed
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package dist-git.noarch 0:0.13-1.git.0.efa5ab8.el7.centos will be installed</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the final command would need to be run with either sudo or root
permissions and that much of the output has been omitted for brevity as the
dependency list is quite long.</p>
</div>
<div class="paragraph">
<p>This concludes our simple example of how to use tito but it has many amazing
features for traditional Systems Administrators, RPM Packagers, and DevOps
Practitioners alike. I would highly recommend consulting the upstream
documentation found at the <em>tito</em> GitHub site for more information on how to
quickly get started using it for your project as well as various advanced
features it offers.</p>
</div>
</div>
<div class="sect3">
<h4 id="dist-git">dist-git</h4>
<div class="paragraph">
<p>The <a href="https://github.com/release-engineering/dist-git">dist-git</a> utility takes a
slightly different approach from that of <a href="https://github.com/dgoodwin/tito">tito</a>
such that instead of keeping the raw source code in <a href="https://git-scm.com/">git</a> it
instead will keep spec files and patches in a git repository and upload the
compressed archive of the source code to what is known as a “look-aside cache”.
The “look-aside-cache”is a term that was coined by the use of RPM Build Systems
storing large files like these “on the side”. A system like this is generally
tied to a proper RPM Build System such as <a href="https://fedorahosted.org/koji/">Koji</a>.
The build system is then configured to pull the items that are listed as
<code>SourceX</code> entries in the spec files in from this look-aside-cache, while the
spec and patches remain in a version control system. There is also a helper
command line tool to assist in this.</p>
</div>
<div class="paragraph">
<p>In an effort to not duplicate documentation, for more information on how to
setup a system such as this please refer to the upstream
<a href="https://github.com/release-engineering/dist-git">dist-git</a> docs.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="more-on-macros">More on Macros</h3>
<div class="paragraph">
<p>There are many built-in RPM Macros and we will cover a few in the following
section, however an exhaustive list can be found at the
<a href="http://rpm.org/user_doc/macros.html">RPM Official Documentation</a>.</p>
</div>
<div class="paragraph">
<p>There are also macros that are provided by your
<a href="https://en.wikipedia.org/wiki/Linux">Linux</a> Distribution, we will cover some of
those provided by <a href="https://getfedora.org/">Fedora</a>,
<a href="https://www.centos.org/">CentOS</a> and
<a href="https://www.redhat.com/en/technologies/linux-platforms">RHEL</a> in this section as
well as provide information on how to inspect your system to learn about others
that we don’t cover or for discovering them on other RPM-based Linux
Distributions.</p>
</div>
<div class="sect3">
<h4 id="defining-your-own">Defining Your Own Macros</h4>
<div class="paragraph">
<p>You can define your own macros. Below is an excerpt from the
<a href="http://rpm.org/user_doc/macros.html">RPM Official Documentation</a>, which provides
a comprehensive reference on macros capabilities.</p>
</div>
<div class="paragraph">
<p>To define a macro, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%global &lt;name&gt;[(opts)] &lt;body&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>All whitespace surrounding <code>\</code> is removed.  Name may be composed of alphanumeric
characters, and the character <code>_</code> and must be at least 3 characters in length. A
macro without an <code>(opts)</code> field is “simple” in that only recursive macro
expansion is performed. A parameterized macro contains an <code>(opts)</code> field. The
<code>opts</code> (the string between parentheses) is passed exactly as is to getopt(3) for
argc/argv processing at the beginning of a macro invocation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Older RPM SPEC files may use the <code>%define &lt;name&gt; &lt;body&gt;</code> macro pattern. The
differences between <code>%define</code> and <code>%global</code> macros are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>%define</code> has local scope, which means that it applies only to a specified
part of a SPEC file. In addition, the body of a <code>%define</code> macro is expanded when
used&#8212;&#8203;it is lazily evaluated.</p>
</li>
<li>
<p><code>%global</code> has global scope, which means that it applies to an entire SPEC
file. In addition, the body of a <code>%global</code> macro is expanded at definition time.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>%global githash 0ec4e58
%global python_sitelib %(%{__python} -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())")</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Macros are always evaluated, even in comments. Sometimes it is harmless.
But in the second example, we are executing python command to get the content of
a macro. This command will be executed even when you comment out the macro. Or
when you put the name of the macro into %changelog. To comment out macro, use
<code>%%</code>. For example: <code>%%global</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="setup">%setup</h4>
<div class="paragraph">
<p>Macro <code>%setup</code> can be used to build the package with source code tarballs.
Standard behavior of the <code>%setup</code> macro can be seen in the <code>rpmbuild</code>
output. At the beginning of each phase macro outputs <code>Executing(%something)</code>.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">Executing(%prep): /bin/sh -e /var/tmp/rpm-tmp.DhddsG</code></pre>
</div>
</div>
<div class="paragraph">
<p>The shell output is set with <code>set -x</code> enabled. To see the content of
<code>/var/tmp/rpm-tmp.DhddsG</code> use the <code>--debug</code> option, since <code>rpmbuild</code> deletes
temporary files after successful build. This displays the setup of environment
variables, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd '/builddir/build/BUILD'
rm -rf 'cello-1.0'
/usr/bin/gzip -dc '/builddir/build/SOURCES/cello-1.0.tar.gz' | /usr/bin/tar -xof -
STATUS=$?
if [ $STATUS -ne 0 ]; then
  exit $STATUS
fi
cd 'cello-1.0'
/usr/bin/chmod -Rf a+rX,u+w,g-w,o-w .</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>%setup</code> ensures that we are working in the right directory, removes
residues of previous builds, unpacks the source tarball, and sets up some
default privileges. There are multiple options to adjust the behavior of the
<code>%setup</code> macro.</p>
</div>
<div class="sect4">
<h5 id="setup-q">%setup -q</h5>
<div class="paragraph">
<p>Option <code>-q</code> limits verbosity of <code>%setup</code> macro. Only <code>tar -xof</code> is
executed instead of <code>tar -xvvof</code>. This option has to be used as first.</p>
</div>
</div>
<div class="sect4">
<h5 id="setup-n">%setup -n</h5>
<div class="paragraph">
<p>In some cases, the directory from expanded tarball has a different name than
expected <code>%{name}-%{version}</code>. This can lead to an error of the <code>%setup</code>
macro.  The name of a directory has to be specified by <code>-n directory_name</code>
option.</p>
</div>
<div class="paragraph">
<p>For example, if the package name is <code>cello</code>, but the source code is archived
in <code>hello-1.0.tgz</code> and contained <code>hello/</code> directory, the SPEC file content
needs to be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name: cello
Source0: https://example.com/%{name}/release/hello-%{version}.tar.gz
…
%prep
%setup -n hello</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="setup-c">%setup -c</h5>
<div class="paragraph">
<p>The <code>-c</code> option can be used if the source code tarball does not contain any
subdirectories and after unpacking, files from an archive fill the current
directory. The <code>-c</code> option creates the directory and steps into the archive
expansion. An illustrative example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/usr/bin/mkdir -p cello-1.0
cd 'cello-1.0'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The directory is not changed after archive expansion.</p>
</div>
</div>
<div class="sect4">
<h5 id="setup-dt">%setup -D and -T</h5>
<div class="paragraph">
<p><code>-D</code> option disables deleting of source code directory. This option is useful
if <code>%setup</code> macro is used several times. Essentially, <code>-D</code> option means that
following lines are not used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">rm -rf 'cello-1.0'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>-T</code> option disables expansion of the source code tarball by removing the
following line from the script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/usr/bin/gzip -dc '/builddir/build/SOURCES/cello-1.0.tar.gz' | /usr/bin/tar -xvvof -</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="setup-ab">%setup -a and -b</h5>
<div class="paragraph">
<p>Options <code>-a</code> and <code>-b</code> expand specific sources.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Option <code>-b</code> (which stands for <code>before</code>) expands specific sources before
entering the working directory.</p>
</li>
<li>
<p>Option <code>-a</code> (which stands for <code>after</code>) expands those sources after entering.
Their arguments are source numbers from the spec file preamble.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, let&#8217;s say the <code>cello-1.0.tar.gz</code> archive contains empty
<code>examples</code> directory, and the examples are shipped in separate
<code>examples.tar.gz</code> tarball and they expand into the directory of the same name.
In this case use <code>-a 1</code>, as we want to expand <code>Source1</code> after entering the
working directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Source0: https://example.com/%{name}/release/%{name}-%{version}.tar.gz
Source1: examples.tar.gz
…
%prep
%setup -a 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>But if the examples were in the separate <code>cello-1.0-examples.tar.gz</code> tarball,
which expands into <code>cello-1.0/examples</code>, use <code>-b 1</code> options, since the
<code>Source1</code> should be expanded before entering the working directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Source0: https://example.com/%{name}/release/%{name}-%{version}.tar.gz
Source1: %{name}-%{version}-examples.tar.gz
…
%prep
%setup -b 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use a combination of all these options.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="files">%files</h4>
<div class="paragraph">
<p>Common “advanced” RPM Macros needed in the <code>%files</code> section are as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Macro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%license</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This identifies the file listed as a LICENSE file and it will be installed and labeled as such by RPM. Example: <code>%license LICENSE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%doc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This identifies the file listed as documentation and it will be installed and labeled as such by RPM. This is often used not only for documentation about the software being packaged but also code examples and various items that should accompany documentation. In the event code examples are included, care should be taken to remove executable mode from the file. Example: <code>%doc README</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%dir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifies that the path is a directory that should be owned by this RPM. This is important so that the RPM file manifest accurately knows what directories to clean up on uninstall. Example: <code>%dir %{_libdir}/%{name}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%config(noreplace)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the following file is a configuration file and therefore should not be overwritten (or replaced) on a package install or update if the file has been modified from the original installation checksum. In the event that there is a change, the file will be created with <code>.rpmnew</code> appended to the end of the filename upon upgrade or install so that the pre-existing or modified file on the target system is not modified. Example: <code>%config(noreplace) %{_sysconfdir}/%{name}/%{name}.conf</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="built-in-macros">Built-In Macros</h4>
<div class="paragraph">
<p>Your system has many built-in RPM Macros and the fastest way to view them all is
to simply run the <code>rpm --showrc</code> command. Note that this will contain a lot of
output so it is often used in combination with a pipe to <code>grep</code>.</p>
</div>
<div class="paragraph">
<p>You can also find information about the RPMs macros that come directly with your
system’s version of RPM by looking at the output of the  <code>rpm -ql rpm</code> taking
note of the files titled <code>macros</code> in the directory structure.</p>
</div>
</div>
<div class="sect3">
<h4 id="rpm-distribution-macros">RPM Distribution Macros</h4>
<div class="paragraph">
<p>Different distributions will supply different sets of recommended RPM Macros
based on the language implementation of the software being packaged or the
specific guidelines of the distribution in question.</p>
</div>
<div class="paragraph">
<p>These are often provided as RPM Packages themselves and can be installed with
the distribution package manager, such as <a href="http://yum.baseurl.org/">yum</a> or
<a href="https://github.com/rpm-software-management/dnf">dnf</a>. The macro files themselves
once installed can be found in <code>/usr/lib/rpm/macros.d/</code> and will be included
in the <code>rpm --showrc</code> output by default once installed.</p>
</div>
<div class="paragraph">
<p>One primary example of this is the
<a href="https://docs.fedoraproject.org/en-US/packaging-guidelines/">Fedora Packaging
Guidelines</a> section pertaining specifically to
<a href="https://docs.fedoraproject.org/en-US/packaging-guidelines/#_domain_specific_guidelines">Application
Specific Guidelines</a> which at the time of this writing has over 60 different
sets of guidelines along with associated RPM Macro sets for subject matter
specific RPM Packaging.</p>
</div>
<div class="paragraph">
<p>One example of this kind of RPMs would be for <a href="https://www.python.org/">Python</a>
version 2.x and if we have the <code>python2-rpm-macros</code> package installed
(available in EPEL for RHEL 7 and CentOS 7), we have a number of python2
specific macros available to us.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -ql python2-rpm-macros
/usr/lib/rpm/macros.d/macros.python2

$ rpm --showrc | grep python2
-14: __python2  /usr/bin/python2
CFLAGS=&quot;%{optflags}&quot; %{__python2} %{py_setup} %{?py_setup_args} build --executable=&quot;%{__python2} %{py2_shbang_opts}&quot; %{?1}
CFLAGS=&quot;%{optflags}&quot; %{__python2} %{py_setup} %{?py_setup_args} install -O1 --skip-build --root %{buildroot} %{?1}
-14: python2_sitearch   %(%{__python2} -c &quot;from distutils.sysconfig import get_python_lib; print(get_python_lib(1))&quot;)
-14: python2_sitelib    %(%{__python2} -c &quot;from distutils.sysconfig import get_python_lib; print(get_python_lib())&quot;)
-14: python2_version    %(%{__python2} -c &quot;import sys; sys.stdout.write('{0.major}.{0.minor}'.format(sys.version_info))&quot;)
-14: python2_version_nodots     %(%{__python2} -c &quot;import sys; sys.stdout.write('{0.major}{0.minor}'.format(sys.version_info))&quot;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above output displays the raw RPM Macro definitions, but we are likely more
interested in what these will evaluate to which we can do with <code>rpm --eval</code> in
order to determine what they do as well as how they may be helpful to us when
packaging RPMs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --eval %{__python2}
/usr/bin/python2

$ rpm --eval %{python2_sitearch}
/usr/lib64/python2.7/site-packages

$ rpm --eval %{python2_sitelib}
/usr/lib/python2.7/site-packages

$ rpm --eval %{python2_version}
2.7

$ rpm --eval %{python2_version_nodots}
27</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-macros">Custom Macros</h3>
<div class="paragraph">
<p>You can override the distribution macros in the <code>~/.rpmmacros</code> file. Any
changes you make  will affect every build on your machine.</p>
</div>
<div class="paragraph">
<p>There are several macros you can use to override:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>%_topdir /opt/some/working/directory/rpmbuild</code></dt>
<dd>
<p>You can create this
directory, including all subdirectories using the <code>rpmdev-setuptree</code> utility.
The value of this macro is by default <code>~/rpmbuild</code>.</p>
</dd>
<dt class="hdlist1"><code>%_smp_mflags -l3</code></dt>
<dd>
<p>This macro is often used to pass to Makefile, for example
<code>make %{?_smp_mflags}</code>, and to set a number of concurrent processes during the
build phase. By default, it is set to <code>-jX</code>, where <code>X</code> is a number of cores.
If you alter the number of cores, you can speed up or slow down a build of
packages.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>While you can define any new macros in the <code>~/.rpmmacros</code> file, this is
discouraged, because those macros would not be present on other machines, where
users may want to try to rebuild your package.</p>
</div>
</div>
<div class="sect2">
<h3 id="epoch-scriptlets-and-triggers">Epoch, Scriptlets, and Triggers</h3>
<div class="paragraph">
<p>There are various topics in the world of RPM SPEC files that are considered
advanced because they have implications on not only the SPEC file, how the
package is built, but also on the end machine that the resulting RPM is
installed upon. In this section we will cover the most common of these such as
Epoch, Scriptlets, and Triggers.</p>
</div>
<div class="sect3">
<h4 id="epoch">Epoch</h4>
<div class="paragraph">
<p>First on the list is <code>Epoch</code>, epoch is a way to define weighted dependencies
based on version numbers. It’s default value is 0 and this is assumed if an
<code>Epoch</code> directive is not listed in the RPM SPEC file. This was not covered in
the SPEC File section of this guide because it is almost always a bad idea to
introduce an Epoch value as it will skew what you would normally otherwise
expect RPM to do when comparing versions of packages.</p>
</div>
<div class="paragraph">
<p>For example if a package <code>foobar</code> with <code>Epoch: 1</code> and <code>Version: 1.0</code> was
installed and someone else packaged <code>foobar</code> with <code>Version: 2.0</code> but simply
omitted the <code>Epoch</code> directive either because they were unaware of its
necessity or simply forgot, that new version would never be considered an update
because the Epoch version would win out over the traditional
Name-Version-Release marker that signifies versioning for RPM Packages.</p>
</div>
<div class="paragraph">
<p>This approach is generally only used when absolutely necessary (as a last
resort) to resolve an upgrade ordering issue which can come up as a side effect
of upstream software changing versioning number schemes or versions
incorporating alphabetical characters that can not always be compared reliably
based on encoding.</p>
</div>
</div>
<div class="sect3">
<h4 id="triggers-and-scriptlets">Scriptlets and Triggers</h4>
<div class="paragraph">
<p>In RPM Packages, there are a series of directives that can be used to inflict
necessary or desired change on a system during install time of the RPM. These
are called <strong>scriptlets</strong>.</p>
</div>
<div class="paragraph">
<p>One primary example of when and why you’d want to do this is when a system
service RPM is installed and it provides a
<a href="https://freedesktop.org/wiki/Software/systemd/">systemd</a>
<a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html">unit file</a>.
At install time we will need to notify
<a href="https://freedesktop.org/wiki/Software/systemd/">systemd</a> that there is a new unit
so that the system administrator can run a command similar to <code>systemctl start
foo.service</code> after the fictional RPM <code>foo</code> (which provides some service
daemon in this example) has been installed. Similarly, we would need to inverse
of this action upon uninstallation so that an administrator would not get errors
due to the daemon’s binary no longer being installed but the unit file still
existing in systemd’s running configuration.</p>
</div>
<div class="paragraph">
<p>There are a small handful of common scriptlet directives, they are similar to
the “section headers” like <code>%build</code> or <code>%install</code> in that they are defined
by multi-line segments of code, often written as standard
<a href="https://en.wikipedia.org/wiki/POSIX">POSIX</a>
shell script but can be a few different programming languages such that RPM for
the target machine’s distribution is configured to allow them. An exhaustive
list of these available languages can be found in the <em>RPM Official
Documentation</em>.</p>
</div>
<div class="paragraph">
<p>Scriptlet directives are as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%pre</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scriptlet that is executed just before the package is installed on the target system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%post</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scriptlet that is executed just after the package is installed on the target system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%preun</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scriptlet that is executed just before the package is uninstalled from the target system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%postun</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scriptlet that is executed just after the package is uninstalled from the target system.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Is is also common for RPM Macros to exist for this function. In our previous
example we discussed <a href="https://freedesktop.org/wiki/Software/systemd/">systemd</a>
needing to be notified about a new
<a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html">unit file</a>,
this is easily handled by the systemd scriptlet macros as we can see from the
below example output. More information on this can be found in the
<a href="https://fedoraproject.org/wiki/Packaging:Systemd">Fedora systemd Packaging
Guidelines</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --showrc | grep systemd
-14: __transaction_systemd_inhibit      %{__plugindir}/systemd_inhibit.so
-14: _journalcatalogdir /usr/lib/systemd/catalog
-14: _presetdir /usr/lib/systemd/system-preset
-14: _unitdir   /usr/lib/systemd/system
-14: _userunitdir       /usr/lib/systemd/user
/usr/lib/systemd/systemd-binfmt %{?*} &gt;/dev/null 2&gt;&amp;1 || :
/usr/lib/systemd/systemd-sysctl %{?*} &gt;/dev/null 2&gt;&amp;1 || :
-14: systemd_post
-14: systemd_postun
-14: systemd_postun_with_restart
-14: systemd_preun
-14: systemd_requires
Requires(post): systemd
Requires(preun): systemd
Requires(postun): systemd
-14: systemd_user_post  %systemd_post --user --global %{?*}
-14: systemd_user_postun        %{nil}
-14: systemd_user_postun_with_restart   %{nil}
-14: systemd_user_preun
systemd-sysusers %{?*} &gt;/dev/null 2&gt;&amp;1 || :
echo %{?*} | systemd-sysusers - &gt;/dev/null 2&gt;&amp;1 || :
systemd-tmpfiles --create %{?*} &gt;/dev/null 2&gt;&amp;1 || :

$ rpm --eval %{systemd_post}

if [ $1 -eq 1 ] ; then
        # Initial installation
        systemctl preset  &gt;/dev/null 2&gt;&amp;1 || :
fi

$ rpm --eval %{systemd_postun}

systemctl daemon-reload &gt;/dev/null 2&gt;&amp;1 || :

$ rpm --eval %{systemd_preun}

if [ $1 -eq 0 ] ; then
        # Package removal, not upgrade
        systemctl --no-reload disable  &gt; /dev/null 2&gt;&amp;1 || :
        systemctl stop  &gt; /dev/null 2&gt;&amp;1 || :
fi</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another item that provides even more fine grained control over the RPM
Transaction as a whole is what is known as <strong>triggers</strong>. These are effectively
the same thing as a scriptlet but are executed in a very specific order of
operations during the RPM install or upgrade transaction allowing for a more
fine grained control over the entire process.</p>
</div>
<div class="paragraph">
<p>The order in which each is executed and the details of which are provided below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">all-%pretrans
...
any-%triggerprein (%triggerprein from other packages set off by new install)
new-%triggerprein
new-%pre      for new version of package being installed
...           (all new files are installed)
new-%post     for new version of package being installed

any-%triggerin (%triggerin from other packages set off by new install)
new-%triggerin
old-%triggerun
any-%triggerun (%triggerun from other packages set off by old uninstall)

old-%preun    for old version of package being removed
...           (all old files are removed)
old-%postun   for old version of package being removed

old-%triggerpostun
any-%triggerpostun (%triggerpostun from other packages set off by old un
            install)
...
all-%posttrans</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above items are from the included RPM documentation found in
<code>/usr/share/doc/rpm/triggers</code> on Fedora systems and
<code>/usr/share/doc/rpm-4.*/triggers</code> on RHEL 7 and CentOS 7 systems.</p>
</div>
<div class="sect4">
<h5 id="Using-Non-Shell-Scripts-in-spec-File">Using Non-Shell Scripts in SPEC File</h5>
<div class="paragraph">
<p>A scriptlet option, <code>-p</code>, in a SPEC file allows to invoke a specific interpreter
instead of the default <code>-p&#160;/bin/sh</code>. An illustrative example is a script,
which prints out a message after the installation of <code>pello.py</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <code>pello.spec</code> file.</p>
</li>
<li>
<p>Find the following line:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">install -m 0644 %{name}.py* %{buildroot}/usr/lib/%{name}/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Under this line, insert the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%post -p /usr/bin/python3
print(&quot;This is {} code&quot;.format(&quot;python&quot;))</code></pre>
</div>
</div>
</li>
<li>
<p>Build your package according to the <a href="#building-rpms">Building RPMS</a> chapter.</p>
</li>
<li>
<p>Install your package:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># dnf install /home/&lt;username&gt;/rpmbuild/RPMS/noarch/pello-0.1.1-1.fc27.noarch.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of this command is the following message after the installation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Installing       : pello-0.1.1-1.fc27.noarch                              1/1
Running scriptlet: pello-0.1.1-1.fc27.noarch                              1/1
This is python code</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>To use a Python&#160;3 script: Write a line <code>%post -p /usr/bin/python3</code> under
the line <code>install -m</code> in a SPEC file.</p>
</li>
<li>
<p>To use a Lua script: Write a line <code>%post -p &lt;lua&gt;</code> under the line
<code>install&#160;-m</code> in a SPEC file.</p>
</li>
<li>
<p>This way any interpreter can be specified in the SPEC file.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rpm-conditionals">RPM Conditionals</h3>
<div class="paragraph">
<p>RPM Conditionals enable the conditional inclusion of various sections of the
SPEC file.</p>
</div>
<div class="paragraph">
<p>Most commonly, conditional inclusions deal with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>architecture-specific sections</p>
</li>
<li>
<p>operating system-specific sections</p>
</li>
<li>
<p>compatibility issues between various versions of operating systems</p>
</li>
<li>
<p>existence and definition of macros</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_rpm_conditionals_syntax">RPM Conditionals Syntax</h4>
<div class="paragraph">
<p>If <em>expression</em> is true, then do some action:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%if expression
...
%endif</pre>
</div>
</div>
<div class="paragraph">
<p>If <em>expression</em> is true, then do some action, in other case, do another action:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%if expression
...
%else
...
%endif</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rpm_conditionals_examples">RPM Conditionals Examples</h4>
<div class="sect4">
<h5 id="_the_if_conditional">The <code>%if</code> Conditional</h5>
<div class="literalblock">
<div class="content">
<pre>%if 0%{?rhel} == 6
sed -i '/AS_FUNCTION_DESCRIBE/ s/^/#/' configure.in
sed -i '/AS_FUNCTION_DESCRIBE/ s/^/#/' acinclude.m4
%endif</pre>
</div>
</div>
<div class="paragraph">
<p>This conditional handles compatibility between RHEL6 and other operating systems
in terms of support of the AS_FUNCTION_DESCRIBE macro. When the package is build
for RHEL, the <code>%rhel</code> macro is defined and it is expanded to RHEL version. If
its value is 6, meaning the package is build for RHEL 6, then the references to
AS_FUNCTION_DESCRIBE, which is not supported by RHEL6, are deleted from
autoconfig scripts.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%if 0%{?el6}
%global ruby_sitearch %(ruby -rrbconfig -e 'puts Config::CONFIG["sitearchdir"]')
%endif</pre>
</div>
</div>
<div class="paragraph">
<p>This conditional handles compatibility between Fedora version 17 and newer and
RHEL6 in terms of support of the <code>%ruby_sitearch</code> macro. Fedora version 17 and
newer defines <code>%ruby_sitearch</code> by default, but RHEL6 does not support this
macro. The conditional checks whether the operating system is RHEL6. If it is,
<code>%ruby_sitearch</code> is defined explicitly. Note that <code>0%{?el6}</code> has the same
meaning as <code>0%{?rhel} == 6</code> from the previous example, and it tests whether a
package is built on RHEL6.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%if 0%{?fedora} &gt;= 19
%global with_rubypick 1
%endif</pre>
</div>
</div>
<div class="paragraph">
<p>This conditional handles support for the rubypick tool. If the operating system
is Fedora version 19 or newer, rubypick is supported.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%define ruby_archive %{name}-%{ruby_version}
%if 0%{?milestone:1}%{?revision:1} != 0
%define ruby_archive %{ruby_archive}-%{?milestone}%{?!milestone:%{?revision:r%{revision}}}
%endif</pre>
</div>
</div>
<div class="paragraph">
<p>This conditional handles definition of the macros. If the <code>%milestone</code> or the
<code>%revision</code> macros are set, the <code>%ruby_archive</code> macro, which defines the name of
the upstream tarball, is redefined.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specialized_variants_of_if_conditional">Specialized variants of <code>%if</code> Conditional</h5>
<div class="paragraph">
<p>The <code>%ifarch</code> conditional, <code>%ifnarch</code> conditional and <code>%ifos</code> conditional are
specialized variants of the <code>%if</code> conditionals. These variants are commonly
used, so they have their own macros.</p>
</div>
<div class="sect5">
<h6 id="_the_ifarch_conditional">The <code>%ifarch</code> Conditional</h6>
<div class="paragraph">
<p>The <code>%ifarch</code> conditional is used to begin a block of the SPEC file that is
architecture-specific. It is followed by one or more architecture specifiers,
each separated by commas or whitespace.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%ifarch i386 sparc
...
%endif</pre>
</div>
</div>
<div class="paragraph">
<p>All the contents of the SPEC file  between <code>%ifarch</code> and <code>%endif</code> are processed
only on the 32-bit AMD and Intel architectures or Sun SPARC-based systems.</p>
</div>
</div>
<div class="sect5">
<h6 id="_the_ifnarch_conditional">The <code>%ifnarch</code> Conditional</h6>
<div class="paragraph">
<p>The <code>%ifnarch</code> conditional has a reverse logic than <code>%ifarch</code> conditional.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%ifnarch alpha
...
%endif</pre>
</div>
</div>
<div class="paragraph">
<p>All the contents of the SPEC file between <code>%ifnarch</code> and <code>%endif</code> are processed
only if not being done on a Digital Alpha/AXP-based system.</p>
</div>
</div>
<div class="sect5">
<h6 id="_the_ifos_conditional">The <code>%ifos</code> Conditional</h6>
<div class="paragraph">
<p>The <code>%ifos</code> conditional is used to control processing based on the operating
system of the build. It can be followed by one or more operating system names.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%ifos linux
...
%endif</pre>
</div>
</div>
<div class="paragraph">
<p>All the contents of the SPEC file between <code>%ifos</code> and <code>%endif</code> are processed
only if the build was done on a Linux system.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_new_features_of_rpm_in_rhel_7">Appendix A: New features of RPM in RHEL 7</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This list documents most noticable changes in RPM packaging between Red Hat
Enterprise Linux 6 and 7.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A new command, <code>rpmkeys</code>, used for keyring import and signature verification
has been added.</p>
</li>
<li>
<p>A new command, <code>rpmspec</code>, used for spec queries and parsed output has been
added.</p>
</li>
<li>
<p>A new command, <code>rpmsign</code>, used for package signing has been added.</p>
</li>
<li>
<p>The <code>posix.exec()</code>  and <code>os.exit()</code> extensions embedded in <code>%{lua:&#8230;&#8203;}</code>
scripts fail the script unless called from a child process created with the
<code>posix.fork()</code> scriptlet.</p>
</li>
<li>
<p>The <code>%pretrans</code> scriptlet failure causes the package installation to be
skipped.</p>
</li>
<li>
<p>Scriptlets can be macro-expanded and queryformat-expanded at runtime.</p>
</li>
<li>
<p>Pre-transaction and post-transaction scriptlet dependencies can now be
correctly expressed with <code>Requires(pretrans)</code> and <code>Requires(posttrans)</code>
scriptlets.</p>
</li>
<li>
<p>The <code>OrderWithRequires</code> tag for supplying additional ordering hints has been
added. The tag follows <code>Requires</code> tag syntax, but does not generate actual
dependencies. The ordering hints are treated as if they were <code>Requires</code> when
calculating the transaction order, only if the involved packages are present in
the same transaction.</p>
</li>
<li>
<p>The <code>%license</code> flag can be used in the <code>%files</code> section. This flag can be
used similar to the <code>%doc</code> flag to mark files as licenses, which need to be
installed despite the <code>--nodocs</code> option.</p>
</li>
<li>
<p>The <code>%autosetup</code> macro for automating patch application, with optional
distributed version control system integration has been added.</p>
</li>
<li>
<p>The  automatic dependency generator has been rewritten into extensible and
customizable rule based system with built-in filtering.</p>
</li>
<li>
<p>The OpenPGP V3 public keys are no longer supported.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">Appendix B: References</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Below are references to various topics of interest around RPMs, RPM packaging,
and RPM building. Some of these are advanced and extend far beyond the
introductory material included in this guide.</p>
</div>
<div class="paragraph">
<p><a href="https://www.softwarecollections.org/en/">Software Collections</a> -
SoftwareCollections.org is an open-source project for building and distributing
community-supported Software Collections (SCLs) for Red Hat Enterprise Linux,
Fedora, CentOS, and Scientific Linux.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.fedoraproject.org/en-US/quick-docs/creating-rpm-packages/index.html">Creating
RPM package</a> - Step-by-step guide for learning basics of RPM packaging.</p>
</div>
<div class="paragraph">
<p><a href="http://www.ibm.com/developerworks/library/l-rpm1/">Packaging software with
RPM, Part 1</a>, <a href="http://www.ibm.com/developerworks/library/l-rpm2/">Part 2</a>,
<a href="http://www.ibm.com/developerworks/library/l-rpm3/">Part 3</a> - IBM RPM
packaging guide.</p>
</div>
<div class="paragraph">
<p><a href="http://rpm.org/documentation">RPM Documentation</a> - The official RPM
documentation.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.fedoraproject.org/en-US/packaging-guidelines/">Fedora Packaging
Guidelines</a> - The official packaging guidelines for Fedora, useful for all
RPM-based distributions.</p>
</div>
<div class="paragraph">
<p><a href="https://pagure.io/rpmfluff">rpmfluff</a> - python library for building RPM packages, and sabotaging them so they are broken in controlled ways.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements">Appendix C: Acknowledgements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Certain portions of this text first appeared in the
<a href="https://rpm-packaging-guide.github.io/">RPM Packaging Guide</a>. Copyright
&copy; 2020 Adam Miller and others. Licensed under a
<a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons
Attribution-ShareAlike 3.0 Unported License</a>.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-09-24 07:32:12 UTC
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</body>
</html>